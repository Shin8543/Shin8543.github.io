[{"title":"","date":"2022-03-27T04:26:52.000Z","path":"2022/03/27/Flink总结/","content":"<h1 id=\"Flink总结\"><a href=\"#Flink总结\" class=\"headerlink\" title=\"Flink总结\"></a>Flink总结</h1><h3 id=\"Flink-核心特点\"><a href=\"#Flink-核心特点\" class=\"headerlink\" title=\"Flink 核心特点\"></a><strong>Flink 核心特点</strong></h3><h3 id=\"批流一体\"><a href=\"#批流一体\" class=\"headerlink\" title=\"批流一体\"></a><strong>批流一体</strong></h3><p>所有的数据都天然带有时间的概念，必然发生在某一个时间点。把事件按照时间顺序排列起来，就形成了一个事件流，也叫作数据流。<strong>「无界数据」</strong>是持续产生的数据，所以必须持续地处理无界数据流。<strong>「有界数据」</strong>，就是在一个确定的时间范围内的数据流，有开始有结束，一旦确定了就不会再改变。</p>\n<h3 id=\"可靠的容错能力\"><a href=\"#可靠的容错能力\" class=\"headerlink\" title=\"可靠的容错能力\"></a><strong>可靠的容错能力</strong></h3><ul>\n<li><p>集群级容错</p>\n<ul>\n<li>集群管理器集成（Hadoop YARN、Mesos或Kubernetes）</li>\n<li>高可用性设置（HA模式基于ApacheZooKeeper）</li>\n</ul>\n</li>\n<li><p>应用级容错（ Checkpoint）</p>\n<ul>\n<li>一致性（其本身支持Exactly-Once 语义）</li>\n<li>轻量级（检查点的执行异步和增量检查点）</li>\n</ul>\n</li>\n<li><p>高吞吐、低延迟</p>\n  <span id=\"more\"></span></li>\n</ul>\n<p><strong><strong>运行时架构</strong></strong></p>\n<p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LQEn41Z2GS02O6O7hHCibq5BXomrtdW1cS2VZA43BSfIaAAZoazia96Vw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LQEn41Z2GS02O6O7hHCibq5BXomrtdW1cS2VZA43BSfIaAAZoazia96Vw&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<ul>\n<li>Flink 客户端<ul>\n<li>提交Flink作业到Flink集群</li>\n<li>Stream Graph 和 Job Graph构建</li>\n</ul>\n</li>\n<li>JobManager<ul>\n<li>资源申请</li>\n<li>任务调度</li>\n<li>应用容错</li>\n</ul>\n</li>\n<li>TaskManager<ul>\n<li>接收JobManager 分发的子任务，管理子任务</li>\n<li>任务处理（消费数据、处理数据）</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Flink-应用\"><a href=\"#Flink-应用\" class=\"headerlink\" title=\"Flink 应用\"></a><strong>Flink 应用</strong></h2><h3 id=\"数据流\"><a href=\"#数据流\" class=\"headerlink\" title=\"数据流\"></a><strong>数据流</strong></h3><h3 id=\"DataStream-体系\"><a href=\"#DataStream-体系\" class=\"headerlink\" title=\"DataStream 体系\"></a><strong>DataStream 体系</strong></h3><ol>\n<li>DataStream(每个DataStream都有一个Transformation对象)</li>\n<li>DataStreamSource（DataStream的起点）</li>\n<li>DataStreamSink（DataStream的输出）</li>\n<li>KeyedStream（表示根据指定的Key记性分组的数据流）</li>\n<li>WindowdeStream &amp; AllWindowedStream（根据key分组且基于WindowAssigner切分窗口的数据流）</li>\n<li>JoinedStreams &amp; CoGroupedStreams<ol>\n<li>JoinedStreams底层使用CoGroupedStreams来实现</li>\n<li>CoGrouped侧重的是Group，对数据进行分组，是对同一个key上的两组集合进行操作</li>\n<li>Join侧重的是数据对，对同一个key的每一对元素进行操作</li>\n</ol>\n</li>\n<li>ConnectedStreams（表示两个数据流的组合）</li>\n<li>BroadcastStream &amp; BroadcastConnectedStream（DataStream的广播行为）</li>\n<li>IterativeStream（包含IterativeStream的Dataflow是一个有向有环图）</li>\n<li>AsyncDataStream（在DataStream上使用异步函数的能力）</li>\n</ol>\n<h3 id=\"处理数据API\"><a href=\"#处理数据API\" class=\"headerlink\" title=\"处理数据API\"></a><strong>处理数据API</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LIMnTCqaiaSmTbrAwabCRU6xKRhRy6CVxoSzBFjzmpHgkZ3krNLPyLYQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LIMnTCqaiaSmTbrAwabCRU6xKRhRy6CVxoSzBFjzmpHgkZ3krNLPyLYQ&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<p>处理数据API</p>\n<h2 id=\"核心抽象\"><a href=\"#核心抽象\" class=\"headerlink\" title=\"核心抽象\"></a><strong>核心抽象</strong></h2><h3 id=\"环境对象\"><a href=\"#环境对象\" class=\"headerlink\" title=\"环境对象\"></a><strong>环境对象</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26L038j26g5tAyeTOeY18NdmAz7hibOHl8ibQPDViaDMAFLJvly9B86668Ag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26L038j26g5tAyeTOeY18NdmAz7hibOHl8ibQPDViaDMAFLJvly9B86668Ag&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"数据流元素\"><a href=\"#数据流元素\" class=\"headerlink\" title=\"数据流元素\"></a><strong>数据流元素</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LBFQ1PJShI7v90l7PCtvTgviabSdebOykwfzyiaTGEq6KARHp3f7CpYyA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LBFQ1PJShI7v90l7PCtvTgviabSdebOykwfzyiaTGEq6KARHp3f7CpYyA&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<ol>\n<li>StreamRecord（数据流中的一条记录｜事件）<ol>\n<li>数据的值本身</li>\n<li>时间戳（可选）</li>\n</ol>\n</li>\n<li>LatencyMarker（用来近似评估延迟）<ol>\n<li>周期性的在数据源算子中创造出来的时间戳</li>\n<li>算子编号</li>\n<li>数据源所在的Task编号</li>\n</ol>\n</li>\n<li>Watemark（是一个时间戳，用来告诉算子所有时间早于等于Watermark的事件或记录都已经到达，不会再有比Watermark更早的记录，算子可以根据Watermark触发窗口的计算、清理资源等）</li>\n<li>StreamStatus（用来通知Task是否会继续接收到上游的记录或者Watermark）<ol>\n<li>空闲状态（IDLE）。</li>\n<li>活动状态（ACTIVE）。</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"Flink-异步IO\"><a href=\"#Flink-异步IO\" class=\"headerlink\" title=\"Flink 异步IO\"></a><strong>Flink 异步IO</strong></h3><h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a><strong>原理</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LlwicEq338A0YXNcOvx7ibnU7J04FOUibice7OG2x7vDXt73WSKvDhSMHcQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LlwicEq338A0YXNcOvx7ibnU7J04FOUibice7OG2x7vDXt73WSKvDhSMHcQ&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<p>顺序输出模式（先收到的数据元素先输出，后续数据元素的异步函数调用无论是否先完成，都需要等待）</p>\n<p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LKYSMNI0t0ibsvYKrsFJZc5mvkdMEgPUb5tn2zjJvng4tnhHPYJamnKw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LKYSMNI0t0ibsvYKrsFJZc5mvkdMEgPUb5tn2zjJvng4tnhHPYJamnKw&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<p>无序输出模式（先处理完的数据元素先输出，不保证消息顺序）</p>\n<p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LPB81fHJTfLz3YkvJyYpmR2bTvg7BsDZJm01HBQqMs4aUica6hIXkeXA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LPB81fHJTfLz3YkvJyYpmR2bTvg7BsDZJm01HBQqMs4aUica6hIXkeXA&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"数据分区\"><a href=\"#数据分区\" class=\"headerlink\" title=\"数据分区\"></a><strong>数据分区</strong></h3><ul>\n<li>ForwardPartitioner（用于在同一个OperatorChain中上下游算子之间的数据转发，实际上数据是直接传递给下游的）</li>\n<li>ShufflePartitioner（随机将元素进行分区，可以确保下游的Task能够均匀地获得数据）</li>\n<li>ReblancePartitioner（以Round-robin的方式为每个元素分配分区，确保下游的Task可以均匀地获得数据，避免数据倾斜）</li>\n<li>RescalingPartitioner（用Round-robin选择下游的一个Task进行数据分区，如上游有2个Source，下游有6个Map，那么每个Source会分配3个固定的下游Map，不会向未分配给自己的分区写入数据）</li>\n<li>BroadcastPartitioner（将该记录广播给所有分区）</li>\n<li>KeyGroupStreamPartitioner（KeyedStream根据KeyGroup索引编号进行分区，该分区器不是提供给用户来用的）</li>\n</ul>\n<h2 id=\"窗口\"><a href=\"#窗口\" class=\"headerlink\" title=\"窗口\"></a><strong>窗口</strong></h2><h3 id=\"实现原理\"><a href=\"#实现原理\" class=\"headerlink\" title=\"实现原理\"></a><strong>实现原理</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LWSPibcS2UTAoI5KdkFShmxBGiaZMHpITwEoqeSOjctmP2K0ep3XO7hkA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LWSPibcS2UTAoI5KdkFShmxBGiaZMHpITwEoqeSOjctmP2K0ep3XO7hkA&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<ul>\n<li>WindowAssigner（用来决定某个元素被分配到哪个&#x2F;哪些窗口中去）</li>\n<li>WindowTrigger（决定一个窗口何时能够被计算或清除，每一个窗口都拥有一个属于自己的Trigger）</li>\n<li>WindowEvictor（窗口数据的过滤器，可在Window Function 执行前或后，从Window中过滤元素）<ul>\n<li>CountEvictor：计数过滤器。在Window中保留指定数量的元素，并从窗口头部开始丢弃其余元素</li>\n<li>DeltaEvictor：阈值过滤器。丢弃超过阈值的数据记录</li>\n<li>TimeEvictor：时间过滤器。保留最新一段时间内的元素</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Watermark-（水印）\"><a href=\"#Watermark-（水印）\" class=\"headerlink\" title=\"Watermark （水印）\"></a><strong>Watermark （水印）</strong></h3><h3 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a><strong>作用</strong></h3><p>用于处理乱序事件，而正确地处理乱序事件，通常用Watermark机制结合窗口来实现</p>\n<h3 id=\"DataStream-Watermark-生成\"><a href=\"#DataStream-Watermark-生成\" class=\"headerlink\" title=\"DataStream Watermark 生成\"></a><strong>DataStream Watermark 生成</strong></h3><ol>\n<li>Source Function 中生成Watermark</li>\n<li>DataStream API 中生成Watermark<ol>\n<li>AssingerWithPeriodicWatermarks （周期性的生成Watermark策略，不会针对每个事件都生成）</li>\n<li>AssingerWithPunctuatedWatermarks （对每个事件都尝试进行Watermark的生成，如果生成的结果是null 或Watermark小于之前的，则不会发往下游）</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"内存管理\"><a href=\"#内存管理\" class=\"headerlink\" title=\"内存管理\"></a><strong>内存管理</strong></h2><h3 id=\"自主内存管理\"><a href=\"#自主内存管理\" class=\"headerlink\" title=\"自主内存管理\"></a><strong>自主内存管理</strong></h3><h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a><strong>原因</strong></h3><ol>\n<li>JVM内存管理的不足<ol>\n<li>有效数据密度低</li>\n<li>垃圾回收（大数据场景下需要消耗大量的内存，更容易触发Full GC ）</li>\n<li>OOM 问题影响稳定性</li>\n<li>缓存未命中问题（Java对象在堆上存储时并不是连续的）</li>\n</ol>\n</li>\n<li>自主内存管理<ol>\n<li>堆上内存的使用、监控、调试简单，堆外内存出现问题后的诊断则较为复杂</li>\n<li>Flink有时需要分配短生命周期的MemorySegment，在堆外内存上分配比在堆上内存开销更高。</li>\n<li>在Flink的测试中，部分操作在堆外内存上会比堆上内存慢</li>\n<li>大内存（上百GB）JVM的启动需要很长时间，Full GC可以达到分钟级。使用堆外内存，可以将大量的数据保存在堆外，极大地减小堆内存，避免GC和内存溢出的问题。</li>\n<li>高效的IO操作。堆外内存在写磁盘或网络传输时是zero-copy，而堆上内存则至少需要1次内存复制。</li>\n<li>堆外内存是进程间共享的。也就是说，即使JVM进程崩溃也不会丢失数据。这可以用来做故障恢复（Flink暂时没有利用这项功能，不过未来很可能会去做）</li>\n<li>堆外内存的优势</li>\n<li>堆外内存的不足</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"内存模型\"><a href=\"#内存模型\" class=\"headerlink\" title=\"内存模型\"></a><strong>内存模型</strong></h3><h3 id=\"内存模型图\"><a href=\"#内存模型图\" class=\"headerlink\" title=\"内存模型图\"></a><strong>内存模型图</strong></h3><p><img src=\"/2022/03/27/Flink%E6%80%BB%E7%BB%93/Untitled.png\" alt=\"Untitled.png\"></p>\n<p><a href=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\">data:image&#x2F;gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg&#x3D;&#x3D;</a></p>\n<h3 id=\"MemorySegment（内存段）\"><a href=\"#MemorySegment（内存段）\" class=\"headerlink\" title=\"MemorySegment（内存段）\"></a><strong>MemorySegment（内存段）</strong></h3><p>一个MemorySegment对应着一个32KB大小的内存块。这块内存既可以是堆上内存（Java的byte数组），也可以是堆外内存（基于Netty的DirectByteBuffer）</p>\n<h3 id=\"图解\"><a href=\"#图解\" class=\"headerlink\" title=\"图解\"></a><strong>图解</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26Lvhm7oviaADm2fJVNxfuGHoMnPt6wzWvct0gX1CwY2pgdcB7Dh9ACnBw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26Lvhm7oviaADm2fJVNxfuGHoMnPt6wzWvct0gX1CwY2pgdcB7Dh9ACnBw&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"结构\"><a href=\"#结构\" class=\"headerlink\" title=\"结构\"></a><strong>结构</strong></h3><ul>\n<li>BYTE_ARRAY_BASE_OFFSET（二进制字节数组的起始索引）</li>\n<li>LITTLE_ENDIAN（判断是否为Little Endian模式的字节存储顺序，若不是，就是Big Endian模式）<ul>\n<li>Big Endian：低地址存放最高有效字节（MSB）</li>\n<li>Little Endian：低地址存放最低有效字节（LSB）X86机器</li>\n</ul>\n</li>\n<li>HeapMemory（如果MemeorySegment使用堆上内存，则表示一个堆上的字节数组（byte［］），如果MemorySegment使用堆外内存，则为null）</li>\n<li>address（字节数组对应的相对地址）</li>\n<li>addressLimit（标识地址结束位置）</li>\n<li>size（内存段的字节数）</li>\n</ul>\n<h3 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a><strong>实现</strong></h3><ul>\n<li>HybirdMemorySegment：用来分配堆上和堆外内存和堆上内存，Flink 在实际使用中只使用了改方式。原因是当有多个实现时，JIT无法直接在编译时自动识别优化</li>\n<li>HeapMemorySegment：用来分配堆上内存，实际没有实现</li>\n</ul>\n<h3 id=\"MemroyManager（内存管理器）\"><a href=\"#MemroyManager（内存管理器）\" class=\"headerlink\" title=\"MemroyManager（内存管理器）\"></a><strong>MemroyManager（内存管理器）</strong></h3><p>实际申请的是堆外内存，通过RocksDB的Block Cache和WriterBufferManager参数来限制，RocksDB使用的内存量</p>\n<h2 id=\"State（状态）\"><a href=\"#State（状态）\" class=\"headerlink\" title=\"State（状态）\"></a><strong>State（状态）</strong></h2><p>状态管理需要考虑的因素：</p>\n<ol>\n<li>状态数据的存储和访问</li>\n<li>状态数据的备份和恢复</li>\n<li>状态数据的划分和动态扩容</li>\n<li>状态数据的清理</li>\n</ol>\n<h3 id=\"分类\"><a href=\"#分类\" class=\"headerlink\" title=\"分类\"></a><strong>分类</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LB4ib6ZWEQCfeicWNqEAg0EEuBnFsMTXYIWDMHHKEAjJAViaanKpyUbLHg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LB4ib6ZWEQCfeicWNqEAg0EEuBnFsMTXYIWDMHHKEAjJAViaanKpyUbLHg&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"状态存储\"><a href=\"#状态存储\" class=\"headerlink\" title=\"状态存储\"></a><strong>状态存储</strong></h3><ul>\n<li>MemoryStateBackend：纯内存，适用于验证、测试，不推荐生产环境</li>\n<li>FsStateBackend：内存+文件，适用于长周期大规模的数据</li>\n<li>RocksDBStateBackend：RocksDB，适用于长周期大规模的数据</li>\n</ul>\n<h3 id=\"重分布\"><a href=\"#重分布\" class=\"headerlink\" title=\"重分布\"></a><strong>重分布</strong></h3><ul>\n<li>ListState：并行度在改变的时候，会将并发上的每个List都取出，然后把这些List合并到一个新的List,根据元素的个数均匀分配给新的Task</li>\n<li>UnionListState:把划分的方式交给用户去做，当改变并发的时候，会将原来的List拼接起来，然后不做划分，直接交给用户</li>\n<li>BroadcastState:变并发的时候，把这些数据分发到新的Task即可</li>\n<li>KeyState：Key-Group数量取决于最大并行度（MaxParallism）</li>\n</ul>\n<h2 id=\"作业提交\"><a href=\"#作业提交\" class=\"headerlink\" title=\"作业提交\"></a><strong>作业提交</strong></h2><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LMacAsdC92FR7PgPEwInorbEiaa1qSZQMsiaPjM782zXhDC54h4yqwgzg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LMacAsdC92FR7PgPEwInorbEiaa1qSZQMsiaPjM782zXhDC54h4yqwgzg&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h2 id=\"资源管理\"><a href=\"#资源管理\" class=\"headerlink\" title=\"资源管理\"></a><strong>资源管理</strong></h2><h3 id=\"关系图\"><a href=\"#关系图\" class=\"headerlink\" title=\"关系图\"></a><strong>关系图</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LxPKtq81wrJkMuDp2cngPo251B5r4WdRB2lIibFKAOXyQjPHxibloaDAA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LxPKtq81wrJkMuDp2cngPo251B5r4WdRB2lIibFKAOXyQjPHxibloaDAA&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"Slot选择策略\"><a href=\"#Slot选择策略\" class=\"headerlink\" title=\"Slot选择策略\"></a><strong>Slot选择策略</strong></h3><ul>\n<li>LocationPreferenceSlotSelectionStrategy（位置优先的选择策略）<ul>\n<li>DefaultLocationPreferenceSlotSelectionStrategy（默认策略），该策略不考虑资源的均衡分配，会从满足条件的可用Slot集合选择第1个</li>\n<li>EvenlySpreadOutLocationPreferenceSlotSelectionStrategy（均衡策略），该策略考虑资源的均衡分配，会从满足条件的可用Slot集合中选择剩余资源最多的Slot，尽量让各个TaskManager均衡地承担计算压力</li>\n</ul>\n</li>\n<li>PreviousAllocationSlotSelectionStrategy（已分配Slot优先的选择策略），如果当前没有空闲的已分配Slot，则仍然会使用位置优先的策略来分配和申请Slot</li>\n</ul>\n<h2 id=\"调度\"><a href=\"#调度\" class=\"headerlink\" title=\"调度\"></a><strong>调度</strong></h2><ul>\n<li>SchedulerNG （调度器）<ul>\n<li>作用</li>\n<li>实现</li>\n</ul>\n<ol>\n<li>DefaultScheduler（使用ScchedulerStrategy来实现）</li>\n<li>LegacyScheduler（实际使用了原来的ExecutionGraph的调度逻辑）</li>\n<li>作业的生命周期管理（开始调度、挂起、取消）</li>\n<li>作业执行资源的申请、分配、释放</li>\n<li>作业状态的管理（发布过程中的状态变化、作业异常时的FailOver</li>\n<li>作业的信息提供，对外提供作业的详细信息</li>\n</ol>\n</li>\n<li>SchedulingStrategy（调度策略）<ul>\n<li>实现</li>\n</ul>\n<ol>\n<li>EagerSchelingStrategy（该调度策略用来执行流计算作业的调度）</li>\n<li>LazyFromSourceSchedulingStrategy（该调度策略用来执行批处理作业的调度）</li>\n<li>startScheduling：调度入口，触发调度器的调度行为</li>\n<li>restartTasks：重启执行失败的Task，一般是Task执行异常导致的</li>\n<li>onExecutionStateChange：当Execution的状态发生改变时</li>\n<li>onPartitionConsumable：当IntermediateResultParitititon中的数据可以消费时</li>\n</ol>\n</li>\n<li>ScheduleMode（调度模式）<ol>\n<li>Eager调度（该模式适用于流计算。一次性申请需要所有的资源，如果资源不足，则作业启动失败。）</li>\n<li>Lazy_From_Sources分阶段调度（适用于批处理。从Source Task开始分阶段调度，申请资源的时候，一次性申请本阶段所需要的所有资源。上游Task执行完毕后开始调度执行下游的Task，读取上游的数据，执行本阶段的计算任务，执行完毕之后，调度后一个阶段的Task，依次进行调度，直到作业执行完成）</li>\n<li>Lazy_From_Sources_With_Batch_Slot_Request分阶段Slot重用调度（适用于批处理。与分阶段调度基本一样，区别在于该模式下使用批处理资源申请模式，可以在资源不足的情况下执行作业，但是需要确保在本阶段的作业执行中没有Shuffle行为）</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"关键组件\"><a href=\"#关键组件\" class=\"headerlink\" title=\"关键组件\"></a><strong>关键组件</strong></h3><h3 id=\"JobMaster\"><a href=\"#JobMaster\" class=\"headerlink\" title=\"JobMaster\"></a><strong>JobMaster</strong></h3><ol>\n<li>调度执行和管理（将JobGraph转化为ExecutionGraph，调度Task的执行，并处理Task的异常）<ul>\n<li>InputSplit 分配</li>\n<li>结果分区跟踪</li>\n<li>作业执行异常</li>\n</ul>\n</li>\n<li>作业Slot资源管理</li>\n<li>检查点与保存点</li>\n<li>监控运维相关</li>\n<li>心跳管理</li>\n</ol>\n<h3 id=\"Task\"><a href=\"#Task\" class=\"headerlink\" title=\"Task\"></a><strong>Task</strong></h3><p>结构</p>\n<p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LdcrpItwLZd9K0wmrfnewMN6eIJkr3LNVgry2xkf9XtDQqh0OBibTUzw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LdcrpItwLZd9K0wmrfnewMN6eIJkr3LNVgry2xkf9XtDQqh0OBibTUzw&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"作业调度失败\"><a href=\"#作业调度失败\" class=\"headerlink\" title=\"作业调度失败\"></a><strong>作业调度失败</strong></h3><h3 id=\"失败异常分类\"><a href=\"#失败异常分类\" class=\"headerlink\" title=\"失败异常分类\"></a><strong>失败异常分类</strong></h3><ul>\n<li>NonRecoverableError：不可恢复的错误。此类错误意味着即便是重启也无法恢复作业到正常状态，一旦发生此类错误，则作业执行失败，直接退出作业执行</li>\n<li>PartitionDataMissingError：分区数据不可访问错误。下游Task无法读取上游Task产生的数据，需要重启上游的Task</li>\n<li>EnvironmentError：环境的错误。这种错误需要在调度策略上进行改进，如使用黑名单机制，排除有问题的机器、服务，避免将失败的Task重新调度到这些机器上。</li>\n<li>RecoverableError：可恢复的错误</li>\n</ul>\n<h2 id=\"容错\"><a href=\"#容错\" class=\"headerlink\" title=\"容错\"></a><strong>容错</strong></h2><h3 id=\"容错保证语义\"><a href=\"#容错保证语义\" class=\"headerlink\" title=\"容错保证语义\"></a><strong>容错保证语义</strong></h3><ul>\n<li>At-Most-Once（最多一次）</li>\n<li>At-Leat-Once（最少一次）</li>\n<li>Exactly-Once（引擎内严格一次）</li>\n<li>End-to-End Exaacly-Once （端到端严格一次）</li>\n</ul>\n<h3 id=\"保存点恢复\"><a href=\"#保存点恢复\" class=\"headerlink\" title=\"保存点恢复\"></a><strong>保存点恢复</strong></h3><ol>\n<li>算子顺序的改变，如果对应的UID没变，则可以恢复，如果对应的UID变了则恢复失败。</li>\n<li>作业中添加了新的算子，如果是无状态算子，没有影响，可以正常恢复，如果是有状态的算子，跟无状态的算子一样处理。</li>\n<li>从作业中删除了一个有状态的算子，默认需要恢复保存点中所记录的所有算子的状态，如果删除了一个有状态的算子，从保存点恢复的时候被删除的OperatorID找不到，所以会报错，可以通过在命令中添加-allowNonRestoredState （short: -n）跳过无法恢复的算子。</li>\n<li>添加和删除无状态的算子，如果手动设置了UID，则可以恢复，保存点中不记录无状态的算子，如果是自动分配的UID，那么有状态算子的UID可能会变（Flink使用一个单调递增的计数器生成UID，DAG改版，计数器极有可能会变），很有可能恢复失败。</li>\n<li>恢复的时候调整并行度，Flink1.2.0及以上版本,如果没有使用作废的API，则没问题；1.2.0以下版本需要首先升级到1.2.0才可以。</li>\n</ol>\n<h3 id=\"端到端严格一次\"><a href=\"#端到端严格一次\" class=\"headerlink\" title=\"端到端严格一次\"></a><strong>端到端严格一次</strong></h3><h3 id=\"前提条件\"><a href=\"#前提条件\" class=\"headerlink\" title=\"前提条件\"></a><strong>前提条件</strong></h3><ul>\n<li>数据源支持断点读取</li>\n<li>外部存储支持回滚机制或者满足幂等性</li>\n</ul>\n<h3 id=\"图解-1\"><a href=\"#图解-1\" class=\"headerlink\" title=\"图解\"></a><strong>图解</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LRp7O1DO4k7bkNnza4W6icV8FjleMoia9EVvqw99ibrAuQCYGd12TFnGIg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LRp7O1DO4k7bkNnza4W6icV8FjleMoia9EVvqw99ibrAuQCYGd12TFnGIg&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h3 id=\"实现-1\"><a href=\"#实现-1\" class=\"headerlink\" title=\"实现\"></a><strong>实现</strong></h3><p>TwoPhaseCommitSinkFunction</p>\n<ol>\n<li>beginTransaction，开启一个事务，在临时目录中创建一个临时文件，之后写入数据到该文件中。此过程为不同的事务创建隔离，避免数据混淆。</li>\n<li>preCommit。预提交阶段。将缓存数据块写出到创建的临时文件，然后关闭该文件，确保不再写入新数据到该文件，同时开启一个新事务，执行属于下一个检查点的写入操作。</li>\n<li>commit。在提交阶段，以原子操作的方式将上一阶段的文件写入真正的文件目录下。如果提交失败，Flink应用会重启，并调用TwoPhaseCommitSinkFunction#recoverAndCommit方法尝试恢复并重新提交事务。</li>\n<li>abort。一旦终止事务，删除临时文件。</li>\n</ol>\n<h2 id=\"Flink-SQL\"><a href=\"#Flink-SQL\" class=\"headerlink\" title=\"Flink SQL\"></a><strong>Flink SQL</strong></h2><h3 id=\"关系图-1\"><a href=\"#关系图-1\" class=\"headerlink\" title=\"关系图\"></a><strong>关系图</strong></h3><p><a href=\"https://mmbiz.qpic.cn/mmbiz_png/2gY1hzDz7dTIxibEDof281h0icUabpR26LYZvzDVB6tRWDtUavgrjNgLPPW4YSib3uWC4PYicvI3PRz1DMh2hQO3kw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1\">https://mmbiz.qpic.cn/mmbiz_png&#x2F;2gY1hzDz7dTIxibEDof281h0icUabpR26LYZvzDVB6tRWDtUavgrjNgLPPW4YSib3uWC4PYicvI3PRz1DMh2hQO3kw&#x2F;640?wx_fmt&#x3D;png&amp;tp&#x3D;webp&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p>\n<h2 id=\"FLINK-API\"><a href=\"#FLINK-API\" class=\"headerlink\" title=\"FLINK API\"></a><strong>FLINK API</strong></h2><h3 id=\"DataStrem-JOIN\"><a href=\"#DataStrem-JOIN\" class=\"headerlink\" title=\"DataStrem JOIN\"></a><strong>DataStrem JOIN</strong></h3><p><strong>Window JOIN</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream.join(otherStream)</span><br><span class=\"line\">    .where(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .equalTo(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .window(&lt;WindowAssigner&gt;)</span><br><span class=\"line\">    .apply(&lt;JoinFunction&gt;)</span><br></pre></td></tr></table></figure>\n\n<p>Tumbling Window Join</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class=\"line\">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class=\"line\"></span><br><span class=\"line\">orangeStream.join(greenStream)</span><br><span class=\"line\">    .where(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .equalTo(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .window(TumblingEventTimeWindows.of(Time.milliseconds(<span class=\"number\">2</span>)))</span><br><span class=\"line\">    .apply (<span class=\"keyword\">new</span> <span class=\"title class_\">JoinFunction</span>&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">join</span><span class=\"params\">(Integer first, Integer second)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> first + <span class=\"string\">&quot;,&quot;</span> + second;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Sliding Window Join</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class=\"line\">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class=\"line\"></span><br><span class=\"line\">orangeStream.join(greenStream)</span><br><span class=\"line\">    .where(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .equalTo(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .window(SlidingEventTimeWindows.of(Time.milliseconds(<span class=\"number\">2</span>) <span class=\"comment\">/* size */</span>, Time.milliseconds(<span class=\"number\">1</span>) <span class=\"comment\">/* slide */</span>))</span><br><span class=\"line\">    .apply (<span class=\"keyword\">new</span> <span class=\"title class_\">JoinFunction</span>&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">join</span><span class=\"params\">(Integer first, Integer second)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> first + <span class=\"string\">&quot;,&quot;</span> + second;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Session Window Join</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class=\"line\">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class=\"line\"></span><br><span class=\"line\">orangeStream.join(greenStream)</span><br><span class=\"line\">    .where(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .equalTo(&lt;KeySelector&gt;)</span><br><span class=\"line\">    .window(EventTimeSessionWindows.withGap(Time.milliseconds(<span class=\"number\">1</span>)))</span><br><span class=\"line\">    .apply (<span class=\"keyword\">new</span> <span class=\"title class_\">JoinFunction</span>&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">join</span><span class=\"params\">(Integer first, Integer second)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> first + <span class=\"string\">&quot;,&quot;</span> + second;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>","tags":[]},{"title":"","date":"2022-03-27T02:38:48.000Z","path":"2022/03/27/MyBatis/","content":"<h1 id=\"MyBatis\"><a href=\"#MyBatis\" class=\"headerlink\" title=\"MyBatis\"></a>MyBatis</h1><ul>\n<li><p>MyBatis简介</p>\n<ul>\n<li><p>原始jdbc操作分析</p>\n<p>  原始jdbc开发存在的问题如下：</p>\n<ol>\n<li>数据库连接创建、释放频繁造成系统资源浪费从而影响系统性能</li>\n<li>sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变java代码。</li>\n<li>查询操作时，需要手动将结果集中的数据手动封装到实体中。插入操作时，需要手动将实体的数据设置到sql语句的占位符位置</li>\n</ol>\n<p>  应对上述问题给出的解决方案：</p>\n<ol>\n<li>使用数据库连接池初始化连接资源</li>\n<li>将sql语句抽取到xml配置文件中</li>\n<li>使用反射、内省等底层技术，自动将实体与表进行属性与字段的自动映射</li>\n</ol>\n</li>\n<li><p>MyBatis简介</p>\n<ul>\n<li>mybatis 是一个优秀的基于java的持久层框架，它内部封装了jdbc，使开发者只需要关注sql语句本身，而不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程。</li>\n<li>mybatis通过xml或注解的方式将要执行的各种 statement配置起来，并通过java对象和statement中sql的动态参数进行映射生成最终执行的sql语句。</li>\n<li>最后mybatis框架执行sql并将结果映射为java对象并返回。采用ORM(Object Relation Mapping)思想解决了实体和数据库映射的问题，对jdbc 进行了封装，屏蔽了jdbc api 底层访问细节，使我们不用与jdbc api 打交道，就可以完成对数据库的持久化操作。</li>\n</ul>\n</li>\n</ul>\n  <span id=\"more\"></span>\n</li>\n<li><p>快速入门</p>\n<ul>\n<li><p>开发步骤</p>\n<p>  MyBatis官网地址：<a href=\"http://www.mybatis.org/mybatis-3/\">http://www.mybatis.org/mybatis-3/</a></p>\n<ul>\n<li><p>添加MyBatis的坐标</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--mybatis坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--mysql驱动坐标--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建user数据表</p>\n<p>  <img src=\"/2022/03/27/MyBatis/Untitled.png\" alt=\"Untitled\"></p>\n</li>\n<li><p>编写User实体类</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">    <span class=\"comment\">//省略get个set方法</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编写映射文件UserMapper.xml</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">mapper</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"keyword\">PUBLIC</span> <span class=\"string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;userMapper&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;findAll&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.bilibili.domain.User&quot;</span>&gt;</span></span><br><span class=\"line\">        select * from User</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编写核心文件SqlMapConfig.xml</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">configuration</span> <span class=\"keyword\">PUBLIC</span> <span class=\"string\">&quot;-//mybatis.org//DTD Config 3.0//EN“ &quot;</span>http://mybatis.org/dtd/mybatis-3-config.dtd<span class=\"string\">&quot;&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">&lt;configuration&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">    &lt;environments default=&quot;</span>development<span class=\"string\">&quot;&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">        &lt;environment id=&quot;</span>development<span class=\"string\">&quot;&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">            &lt;transactionManager type=&quot;</span>JDBC<span class=\"string\">&quot;/&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">            &lt;dataSource type=&quot;</span>POOLED<span class=\"string\">&quot;&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">                &lt;property name=&quot;</span>driver<span class=\"string\">&quot; value=&quot;</span>com.mysql.jdbc.Driver<span class=\"string\">&quot;/&gt;&lt;property name=&quot;</span>url<span class=\"string\">&quot; value=&quot;</span>jdbc:mysql:///test<span class=\"string\">&quot;/&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">                &lt;property name=&quot;</span>username<span class=\"string\">&quot; value=&quot;</span>root<span class=\"string\">&quot;/&gt;&lt;property name=&quot;</span>password<span class=\"string\">&quot; value=&quot;</span>root<span class=\"string\">&quot;/&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">            &lt;/dataSource&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">        &lt;/environment&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">    &lt;/environments&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">    &lt;mappers&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\"> &lt;mapper resource=&quot;</span>com/bilibili/mapper/UserMapper.xml<span class=\"string\">&quot;/&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\"> &lt;/mappers&gt;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"meta\">&lt;/configuration&gt;</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编写测试类</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//加载核心配置文件</span></span><br><span class=\"line\"><span class=\"type\">InputStream</span> <span class=\"variable\">resourceAsStream</span> <span class=\"operator\">=</span> Resources.getResourceAsStream(<span class=\"string\">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//获得sqlSession工厂对象</span></span><br><span class=\"line\"><span class=\"type\">SqlSessionFactory</span> <span class=\"variable\">sqlSessionFactory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class=\"line\"><span class=\"comment\">//获得sqlSession对象</span></span><br><span class=\"line\"><span class=\"type\">SqlSession</span> <span class=\"variable\">sqlSession</span> <span class=\"operator\">=</span> sqlSessionFactory.openSession();</span><br><span class=\"line\"><span class=\"comment\">//执行sql语句</span></span><br><span class=\"line\">List&lt;User&gt; userList = sqlSession.selectList(<span class=\"string\">&quot;userMapper.findAll&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">//打印结果</span></span><br><span class=\"line\">System.out.println(userList);</span><br><span class=\"line\"><span class=\"comment\">//释放资源</span></span><br><span class=\"line\">sqlSession.close();</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>映射文件概述</p>\n<p>  <img src=\"/2022/03/27/MyBatis/Untitled1.png\" alt=\"Untitled\"></p>\n</li>\n<li><p>增删改查操作</p>\n<ul>\n<li>插入数据操作<ul>\n<li>插入语句使用insert标签</li>\n<li>在映射文件中使用parameterType属性指定要插入的数据类型</li>\n<li>Sql语句中使用#{实体属性名}方式引用实体中的属性值</li>\n<li>插入操作使用的API是sqlSession.insert(“命名空间.id”,实体对象);</li>\n<li>插入操作涉及数据库数据变化，所以要使用sqlSession对象显示的提交事务，即sqlSession.commit()</li>\n</ul>\n</li>\n<li>修改数据操作<ul>\n<li>修改语句使用update标签</li>\n<li>修改操作使用的API是sqlSession.update(“命名空间.id”,实体对象);</li>\n</ul>\n</li>\n<li>删除数据操作<ul>\n<li>删除语句使用delete标签</li>\n<li>Sql语句中使用#{任意字符串}方式引用传递的单个参数</li>\n<li>删除操作使用的API是sqlSession.delete(“命名空间.id”,Object);</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>核心配置文件概述</p>\n<ul>\n<li><strong>MyBatis常用配置解析</strong><ul>\n<li><p><strong>environments标签</strong></p>\n<p>  数据库环境的配置，支持多环境配置</p>\n<p>  <img src=\"/2022/03/27/MyBatis/Untitled2.png\" alt=\"Untitled\"></p>\n<p>  其中，事务管理器（transactionManager）类型有两种：</p>\n<ul>\n<li>JDBC：这个配置就是直接使用了JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域。</li>\n<li>MANAGED：这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如JEE 应用服务器的上下文）。默认情况下它会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。</li>\n</ul>\n<p>  其中，数据源（dataSource）类型有三种：</p>\n<ul>\n<li>UNPOOLED：这个数据源的实现只是每次被请求时打开和关闭连接。</li>\n<li>POOLED：这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来。</li>\n<li>JNDI：这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个JNDI 上下文的引用。</li>\n</ul>\n</li>\n<li><p><strong>mapper标签</strong></p>\n<p>  该标签的作用是加载映射的，加载方式有如下几种：</p>\n<ul>\n<li>使用相对于类路径的资源引用，例如：<mapper resource=\"org/mybatis/builder/AuthorMapper.xml\"></mapper></li>\n<li>使用完全限定资源定位符（URL），例如：<mapper url=\"file:///var/mappers/AuthorMapper.xml\"></mapper></li>\n<li>使用映射器接口实现类的完全限定类名，例如：<mapper class=\"org.mybatis.builder.AuthorMapper\"></mapper></li>\n<li>将包内的映射器接口实现全部注册为映射器，例如：<package name=\"org.mybatis.builder\"></package></li>\n</ul>\n</li>\n<li><p><strong>Properties标签</strong></p>\n<p>  实际开发中，习惯将数据源的配置信息单独抽取成一个properties文件，该标签可以加载额外配置的properties文件</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--通过properties标签加载外部properties文件--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">&quot;jdbc.properties&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--数据源环境--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">&quot;developement&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;developement&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;JDBC&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">transactionManager</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;POOLED&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;driver&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;url&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;username&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;password&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>typeAliases标签</strong></p>\n<p>  类型别名是为Java 类型设置一个短的名字。原来的类型名称配置如下</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;findAll&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;com.bilibili.domain.User&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  配置typeAliases，为com.bilibili.domain.User定义别名为user</p>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--自定义别名--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">typeAliases</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">typeAlias</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;com.bilibili.domain.User&quot;</span> <span class=\"attr\">alias</span>=<span class=\"string\">&quot;user&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">typeAlias</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--使用别名--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;findAll&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;user&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>  上面我们是自定义的别名，mybatis框架已经为我们设置好的一些常用的类型的别名</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>API</p>\n<ul>\n<li><p><strong>SqlSession工厂构建器SqlSessionFactoryBuilder</strong></p>\n<p>  常用API：SqlSessionFactory build(InputStream inputStream)通过加载mybatis的核心文件的输入流的形式构建一个SqlSessionFactory对象</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;org/mybatis/builder/mybatis-config.xml&quot;</span>; </span><br><span class=\"line\"><span class=\"type\">InputStream</span> <span class=\"variable\">inputStream</span> <span class=\"operator\">=</span> Resources.getResourceAsStream(resource); </span><br><span class=\"line\"><span class=\"type\">SqlSessionFactoryBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SqlSessionFactoryBuilder</span>(); </span><br><span class=\"line\"><span class=\"type\">SqlSessionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> builder.build(inputStream);</span><br></pre></td></tr></table></figure>\n<p>  其中， Resources 工具类，这个类在 org.apache.ibatis.io 包中。Resources 类帮助你从类路径下、文件系统或一个 web URL 中加载资源文件。</p>\n</li>\n<li><p><strong>SqlSession工厂对象SqlSessionFactory</strong></p>\n<p>  SqlSessionFactory 有多个个方法创建SqlSession 实例。常用的有如下两个：</p>\n<ul>\n<li>openSession()：会默认开启一个事务，但事务不会自动提交，也就意味着需要手动提交该事务，更新操作数据才会持久化到数据库中</li>\n<li>openSession(boolean autoCommit)：参数为是否自动提交，如果设置为true，那么不需要手动提交事务</li>\n</ul>\n</li>\n<li><p><strong>SqlSession会话对象</strong></p>\n<p>  SqlSession 实例在 MyBatis 中是非常强大的一个类。在这里你会看到所有执行语句、提交或回滚事务和获取映射器实例的方法。</p>\n<p>  执行语句的方法主要有：</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;T&gt; T <span class=\"title function_\">selectOne</span><span class=\"params\">(String statement, Object parameter)</span> </span><br><span class=\"line\">&lt;E&gt; List&lt;E&gt; <span class=\"title function_\">selectList</span><span class=\"params\">(String statement, Object parameter)</span> </span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">insert</span><span class=\"params\">(String statement, Object parameter)</span> </span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">update</span><span class=\"params\">(String statement, Object parameter)</span> </span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">delete</span><span class=\"params\">(String statement, Object parameter)</span></span><br></pre></td></tr></table></figure>\n<p>  操作事务的方法主要有：</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">commit</span><span class=\"params\">()</span>  </span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">rollback</span><span class=\"params\">()</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>MyBatis的Dao层实现</p>\n<ul>\n<li>代理开发方式<ul>\n<li><p>介绍</p>\n<p>  采用MyBatis的代理开发方式实现DAO层的开发，这种方式是企业里的主流</p>\n<p>  Mapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由MyBatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。</p>\n</li>\n<li><p>规范</p>\n<ol>\n<li>Mapper.xml文件中的namespace与mapper接口的全限定名相同</li>\n<li>Mapper接口方法名和Mapper.xml中定义的每个statement的id相同</li>\n<li>Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同</li>\n<li>Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong>占位符 # 和 $ 的区别</strong></p>\n<p>  <strong>#{}</strong> 和 <strong>${}</strong> 都可以替代参数，即占位符</p>\n<p>  <strong>#{}</strong> 在SQL语句运行的时候显示的是一个一个的 <strong>？ ？ ？</strong></p>\n<p>  例如针对根据某个ID的一条删除语句，ID号用 #{id} 替代</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;delete id=<span class=\"string\">&quot;deleteData&quot;</span> parameterType=<span class=\"string\">&quot;int&quot;</span>&gt;</span><br><span class=\"line\">   delete from Products <span class=\"type\">where</span> <span class=\"variable\">ProductID</span> <span class=\"operator\">=</span> #&#123;id&#125;</span><br><span class=\"line\">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>\n<p>  输出的SQL日志如下 ：</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Preparing: delete from Products <span class=\"type\">where</span> <span class=\"variable\">ProductID</span> <span class=\"operator\">=</span> ? </span><br><span class=\"line\">==&gt; Parameters: <span class=\"number\">2</span>(Integer)</span><br><span class=\"line\">&lt;==    Updates: <span class=\"number\">1</span></span><br><span class=\"line\">[Products] 已经删除第<span class=\"number\">2</span>条记录！</span><br></pre></td></tr></table></figure>\n<p>  <strong>#{ }</strong> 在处理接受的字段会当做字符串处理，会把传入的参数自动加上引号””，例如这里如果想要删掉 ID&#x3D;2 的记录</p>\n<p>  当执行函数 deleteData（2）的时候，输出的SQL语句实际上是：</p>\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> Products <span class=\"keyword\">where</span> ProductID <span class=\"operator\">=</span> &quot;2&quot;</span><br></pre></td></tr></table></figure>\n<p>  而 <strong>${ }</strong> 不会自动添加引号”” ，就是简单的字符串拼接，容易引发SQL语句注入的安全隐患，所以一般还是<strong>推荐使用 #{ }</strong>.</p>\n</li>\n<li><p>动态sql语句</p>\n<ul>\n<li><p>if</p>\n<p>  我们根据实体类的不同取值，使用不同的 SQL语句来进行查询。比如在 id如果不为空时可以根据id查询，如果username 不同空时还要加入用户名作为条件。这种情况在我们的多条件组合查询中经常会碰到。</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;select <span class=\"built_in\">id</span>=<span class=\"string\">&quot;findByCondition&quot;</span> parameterType=<span class=\"string\">&quot;user&quot;</span> resultType=<span class=\"string\">&quot;user&quot;</span>&gt;</span><br><span class=\"line\">    select * from User</span><br><span class=\"line\">    &lt;<span class=\"built_in\">where</span>&gt;</span><br><span class=\"line\">        &lt;<span class=\"keyword\">if</span> <span class=\"built_in\">test</span>=<span class=\"string\">&quot;id!=0&quot;</span>&gt;</span><br><span class=\"line\">            and <span class=\"built_in\">id</span>=<span class=\"comment\">#&#123;id&#125;</span></span><br><span class=\"line\">        &lt;/if&gt;</span><br><span class=\"line\">        &lt;<span class=\"keyword\">if</span> <span class=\"built_in\">test</span>=<span class=\"string\">&quot;username!=null&quot;</span>&gt;</span><br><span class=\"line\">            and username=<span class=\"comment\">#&#123;username&#125;</span></span><br><span class=\"line\">        &lt;/if&gt;</span><br><span class=\"line\">    &lt;/where&gt;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>foreach</p>\n<p>  循环执行sql的拼接操作，例如：SELECT * FROM USER WHERE id IN (1,2,5)。</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;select <span class=\"built_in\">id</span>=<span class=\"string\">&quot;findByIds&quot;</span> parameterType=<span class=\"string\">&quot;list&quot;</span> resultType=<span class=\"string\">&quot;user&quot;</span>&gt;</span><br><span class=\"line\">    select * from User</span><br><span class=\"line\">    &lt;<span class=\"built_in\">where</span>&gt;</span><br><span class=\"line\">        &lt;foreach collection=<span class=\"string\">&quot;array&quot;</span> open=<span class=\"string\">&quot;id in(&quot;</span> close=<span class=\"string\">&quot;)&quot;</span> item=<span class=\"string\">&quot;id&quot;</span> separator=<span class=\"string\">&quot;,&quot;</span>&gt;</span><br><span class=\"line\">            <span class=\"comment\">#&#123;id&#125;</span></span><br><span class=\"line\">        &lt;/foreach&gt;</span><br><span class=\"line\">    &lt;/where&gt;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>  foreach标签的属性含义如下：</p>\n<p>  <foreach>标签用于遍历集合，它的属性：</foreach></p>\n<ul>\n<li>collection：代表要遍历的集合元素，注意编写时不要写#{}</li>\n<li>open：代表语句的开始部分</li>\n<li>close：代表结束部分</li>\n<li>item：代表遍历集合的每个元素，生成的变量名</li>\n<li>sperator：代表分隔符</li>\n</ul>\n</li>\n<li><p>sql片段抽取</p>\n<p>  <img src=\"/2022/03/27/MyBatis/Untitled3.png\" alt=\"Untitled\"></p>\n</li>\n</ul>\n</li>\n<li><p>核心配置文件深入</p>\n<ul>\n<li><p>properties标签：该标签可以加载外部的properties文件</p>\n</li>\n<li><p>typeAliases标签：设置类型别名</p>\n</li>\n<li><p>environments标签：数据源环境配置标签</p>\n</li>\n<li><p><strong>typeHandlers标签</strong></p>\n<p>  无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会用类型处理器将获取的值以合适的方式转换成 Java 类型。下表描述了一些默认的类型处理器（截取部分）。</p>\n<p>  <img src=\"/2022/03/27/MyBatis/Untitled4.png\" alt=\"Untitled\"></p>\n<p>  你可以重写类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型。具体做法为：实现 org.apache.ibatis.type.TypeHandler 接口， 或继承一个很便利的类 org.apache.ibatis.type.BaseTypeHandler， 然后可以选择性地将它映射到一个JDBC类型。例如需求：一个Java中的Date数据类型，我想将之存到数据库的时候存成一个1970年至今的毫秒数，取出来时转换成java的Date，即java的Date与数据库的varchar毫秒值之间转换。</p>\n<ul>\n<li>开发步骤<ol>\n<li>定义转换类继承类BaseTypeHandler<T></T></li>\n<li>覆盖4个未实现的方法，其中setNonNullParameter为java程序设置数据到数据库的回调方法，getNullableResult为查询时 mysql的字符串类型转换成 java的Type类型的方法</li>\n<li>在MyBatis核心配置文件中进行注册</li>\n<li>测试转换是否正确</li>\n</ol>\n</li>\n<li>示例  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyDateTypeHandler</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">BaseTypeHandler</span>&lt;Date&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setNonNullParameter</span><span class=\"params\">(PreparedStatement preparedStatement, <span class=\"type\">int</span> i, Date date, JdbcType type)</span> &#123;</span><br><span class=\"line\">        preparedStatement.setString(i,date.getTime()+<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Date <span class=\"title function_\">getNullableResult</span><span class=\"params\">(ResultSet resultSet, String s)</span> <span class=\"keyword\">throws</span> SQLException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(resultSet.getLong(s));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Date <span class=\"title function_\">getNullableResult</span><span class=\"params\">(ResultSet resultSet, <span class=\"type\">int</span> i)</span> <span class=\"keyword\">throws</span> SQLException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(resultSet.getLong(i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Date <span class=\"title function_\">getNullableResult</span><span class=\"params\">(CallableStatement callableStatement, <span class=\"type\">int</span> i)</span> <span class=\"keyword\">throws</span> SQLException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> callableStatement.getDate(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--注册类型自定义转换器--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">typeHandlers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">typeHandler</span> <span class=\"attr\">handler</span>=<span class=\"string\">&quot;com.bilibili.typeHandlers.MyDateTypeHandler&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">typeHandler</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>plugins标签</p>\n<p>  MyBatis可以使用第三方的插件来对功能进行扩展，分页助手PageHelper是将分页的复杂操作进行封装，使用简单的方式即可获得分页的相关数据</p>\n<ul>\n<li>开发步骤<ol>\n<li>导入通用PageHelper的坐标</li>\n<li>在mybatis核心配置文件中配置PageHelper插件</li>\n<li>测试分页数据获取</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>MyBatis的多表操作</p>\n</li>\n<li><p>MyBatis注解</p>\n<ul>\n<li><p>常用注解</p>\n<p>  @Insert：实现新增</p>\n<p>  @Update：实现更新</p>\n<p>  @Delete：实现删除</p>\n<p>  @Select：实现查询</p>\n<p>  @Result：实现结果集封装</p>\n<p>  @Results：可以与@Result 一起使用，封装多个结果集</p>\n<p>  @One：实现一对一结果集封装</p>\n<p>  @Many：实现一对多结果集封装</p>\n</li>\n<li><p><strong>MyBatis的注解实现复杂映射开发</strong></p>\n<p>  实现复杂关系映射之前我们可以在映射文件中通过配置<resultMap>来实现，使用注解开发后，我们可以使用@Results注解，@Result注解，@One注解，@Many注解组合完成复杂关系的配置</resultMap></p>\n</li>\n</ul>\n</li>\n</ul>\n","tags":[]},{"title":"","date":"2021-06-30T15:01:37.000Z","path":"2021/06/30/mysql/","content":"<h1 id=\"MySQL笔记\"><a href=\"#MySQL笔记\" class=\"headerlink\" title=\"MySQL笔记\"></a>MySQL笔记</h1><h1 id=\"第一章-数据库概述\"><a href=\"#第一章-数据库概述\" class=\"headerlink\" title=\"第一章 数据库概述\"></a>第一章 数据库概述</h1><h2 id=\"1-1-为什么要使用数据库\"><a href=\"#1-1-为什么要使用数据库\" class=\"headerlink\" title=\"1.1 为什么要使用数据库\"></a>1.1 为什么要使用数据库</h2><ul>\n<li>持久化(persistence)：<strong>把数据保存到可掉电式存储设备中以供之后使用</strong>。大多数情况下，特别是企业级应用，<strong>数据持久化意味着将内存中的数据保存到硬盘上加以”固化”</strong>，而持久化的实现过程大多通过各种关系数据库来完成。</li>\n<li>持久化的主要应用是<strong>将内存中的数据存储在关系型数据库中</strong>，当然也可以存储在磁盘文件、XML数据文件中。</li>\n</ul>\n<p><img src=\"/2021/06/30/mysql/1554904031332.png\" alt=\"1554904031332\"></p>\n<p><img src=\"/2021/06/30/mysql/1554944967857.png\" alt=\"1554944967857\"></p>\n<h2 id=\"1-2-数据库的相关概念\"><a href=\"#1-2-数据库的相关概念\" class=\"headerlink\" title=\"1.2 数据库的相关概念\"></a>1.2 数据库的相关概念</h2><table>\n<thead>\n<tr>\n<th>DB：数据库（Database）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>即存储数据的“仓库”。它保存了一系列有组织的数据。</td>\n</tr>\n<tr>\n<td><strong>DBMS：数据库管理系统（Database Management System）</strong></td>\n</tr>\n<tr>\n<td>是一种操纵和管理数据库的大型软件，例如建立、使用和维护数据库。</td>\n</tr>\n<tr>\n<td><strong>SQL：结构化查询语言（Structure Query Language）</strong></td>\n</tr>\n<tr>\n<td>专门用来与数据库通信的语言。</td>\n</tr>\n</tbody></table>\n<span id=\"more\"></span>\n\n<h2 id=\"1-3-常见的数据库管理系统-DBMS\"><a href=\"#1-3-常见的数据库管理系统-DBMS\" class=\"headerlink\" title=\"1.3 常见的数据库管理系统(DBMS)\"></a>1.3 常见的数据库管理系统(DBMS)</h2><p>目前互联网上常见的数据库管理软件有Sybase、DB2、Oracle、MySQL、Access、Visual Foxpro（面向对象型）、MS SQL Server、Informix、PostgreSQL（最符合SQL标准，但是性能差）这几种。以下是2019年<strong>DB-Engines Ranking</strong> 对各数据库受欢迎程度进行调查后的统计结果：（查看数据库最新排名:<a href=\"https://db-engines.com/en/ranking%EF%BC%89\">https://db-engines.com/en/ranking）</a></p>\n<p><img src=\"/2021/06/30/mysql/1554945324249.png\" alt=\"1554945324249\"></p>\n<p>对应的走势图：（<a href=\"https://db-engines.com/en/ranking_trend%EF%BC%89\">https://db-engines.com/en/ranking_trend）</a></p>\n<p><img src=\"/2021/06/30/mysql/1554945531693.png\" alt=\"1554945531693\"></p>\n<p>- </p>\n<h1 id=\"第二章-MySQL数据库\"><a href=\"#第二章-MySQL数据库\" class=\"headerlink\" title=\"第二章 MySQL数据库\"></a>第二章 MySQL数据库</h1><h2 id=\"2-1-MySQL概述\"><a href=\"#2-1-MySQL概述\" class=\"headerlink\" title=\"2.1 MySQL概述\"></a>2.1 MySQL概述</h2><p><strong>MySQL</strong>是一种开放源代码的关系型数据库管理系统，开发者为瑞典MySQL AB公司。在2008年1月16号被Sun公司收购。而2009年,SUN又被Oracle收购。目前 MySQL被广泛地应用在Internet上的中小型网站中。由于其<strong>体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，使得很多互联网公司选择了MySQL作为网站数据库</strong>（Facebook, Twitter, YouTube，阿里的蚂蚁金服，去哪儿，魅族，百度外卖，腾讯）。</p>\n<p><img src=\"/2021/06/30/mysql/1554945212252.png\" alt=\"1554945212252\"></p>\n<ul>\n<li><p>阿里巴巴&#x2F;蚂蚁金服主要使用两种关系数据库：OceanBase和MySQL。数据规模：MySQL单台机器TB级，OceanBase单个集群从几个TB到几百个TB皆有。</p>\n</li>\n<li><p>去哪儿：MySQL，Redis，HBase</p>\n</li>\n<li><p>腾讯社交网络主要使用深度定制MySQL数据库+自研NoSQL，规模万台以上服务器，千万级qps。</p>\n</li>\n<li><p>百度外卖目前线上主要使用Mysql、redis等数据库。MySQL 数据数百TB级，redis 数据几TB级。</p>\n</li>\n<li><p>目前魅族OLTP场景主要使用的是MySQL，缓存服务使用的是Redis。数据库实例近1000，数据大小100T+, redis实例1000+。</p>\n</li>\n</ul>\n<h2 id=\"2-2-MySQL数据库的卸载\"><a href=\"#2-2-MySQL数据库的卸载\" class=\"headerlink\" title=\"2.2 MySQL数据库的卸载\"></a>2.2 MySQL数据库的卸载</h2><h3 id=\"步骤一：软件的卸载\"><a href=\"#步骤一：软件的卸载\" class=\"headerlink\" title=\"步骤一：软件的卸载\"></a>步骤一：软件的卸载</h3><p><strong>方式一：通过控制面板卸载</strong></p>\n<p><img src=\"/2021/06/30/mysql/MySQL%E5%8D%B8%E8%BD%BD1.jpg\"></p>\n<p><strong>方式二：通过360或电脑管家等软件卸载</strong></p>\n<p><img src=\"/2021/06/30/mysql/MySQL%E5%8D%B8%E8%BD%BD2.jpg\"></p>\n<p> <strong>方式三：通过安装包提供的卸载功能卸载</strong></p>\n<p><img src=\"/2021/06/30/mysql/MySQL%E5%8D%B8%E8%BD%BD3.jpg\"></p>\n<h3 id=\"步骤二：清理残余文件\"><a href=\"#步骤二：清理残余文件\" class=\"headerlink\" title=\"步骤二：清理残余文件\"></a>步骤二：清理残余文件</h3><p>如果再次安装不成功，可以卸载后对残余文件进行清理后再安装。</p>\n<p><img src=\"/mysql%5C%E6%B8%85%E7%90%86%E6%AE%8B%E4%BD%99%E6%96%87%E4%BB%B6.jpg\"></p>\n<blockquote>\n<p>注意：请在卸载前做好数据备份</p>\n<p>在操作完以后，需要重启计算机，然后进行安装即可。<strong>如果仍然安装失败，需要继续操作如下步骤三。</strong></p>\n</blockquote>\n<h3 id=\"步骤三：清理注册表（选做）\"><a href=\"#步骤三：清理注册表（选做）\" class=\"headerlink\" title=\"步骤三：清理注册表（选做）\"></a>步骤三：清理注册表（选做）</h3><p>如何打开注册表编辑器：在系统 ces\\Eventlog\\Application\\MySQL服务目录删除</p>\n<ul>\n<li>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MySQL服务删除</li>\n</ul>\n<blockquote>\n<p>注册表中的ControlSet001,ControlSet002,不一定是001和002,可能是ControlSet005、006之类</p>\n</blockquote>\n<h2 id=\"2-3-MySQL数据库的安装\"><a href=\"#2-3-MySQL数据库的安装\" class=\"headerlink\" title=\"2.3 MySQL数据库的安装\"></a>2.3 MySQL数据库的安装</h2><ul>\n<li><p>双击<code>mysql-installer-community-5.7.28.0.msi</code>,进入安装界面后选择<strong>Custom自定义安装</strong>，点击<strong>Next</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%851.jpg\"></p>\n</li>\n<li><p>在左侧目录中选择<strong>MySQL Server 5.7.28 -X64</strong>，点击<code>→</code>加载到右侧，点击右下角<strong>Advanced Options设置安装路径</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%852.jpg\"></p>\n</li>\n<li><p>将<strong>安装路径</strong>和<strong>数据路径</strong>修改到<code>D:\\develop\\</code>下，点击<strong>OK</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%853.jpg\"></p>\n</li>\n<li><p>点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%854.jpg\"></p>\n</li>\n<li><p>点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%855.jpg\"></p>\n</li>\n<li><p>点击<strong>Execute执行安装</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%856.jpg\"></p>\n</li>\n<li><p>安装完成，点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%857.jpg\"></p>\n</li>\n<li><p>点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%858.jpg\"></p>\n</li>\n<li><p>点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%859.jpg\"></p>\n</li>\n<li><p>将MySQL配置类型选择<strong>Development Computer开发电脑设置</strong>，点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8510.jpg\"></p>\n</li>\n<li><p>设置MySQL密码，因为管理员用户为root，学习初期建议将MySQL数据库密码设置为比较简单一点，比如(123456)，设置完成后，点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8511.jpg\"></p>\n</li>\n<li><p>设置<strong>Windows Service 系统服务</strong>，设置完毕后点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8512.jpg\"></p>\n</li>\n<li><p>日志设置，不做任何修改，点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8513.jpg\"></p>\n</li>\n<li><p>高级设置，不做任何修改，点击<strong>Next下一步</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8514.jpg\"></p>\n</li>\n<li><p>点击<strong>Execute执行设置</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8515.jpg\"></p>\n</li>\n<li><p>安装完成，点击<strong>Finish完成</strong></p>\n<p>  <img src=\"/2021/06/30/mysql/MySQL%E5%AE%89%E8%A3%8516.jpg\"></p>\n</li>\n</ul>\n<h2 id=\"2-4-MySQL数据库服务的启动和停止\"><a href=\"#2-4-MySQL数据库服务的启动和停止\" class=\"headerlink\" title=\"2.4 MySQL数据库服务的启动和停止\"></a>2.4 MySQL数据库服务的启动和停止</h2><p>MySQL软件的服务器端必须先启动，客户端才可以连接和使用使用数据库。</p>\n<h3 id=\"方式一：图形化方式\"><a href=\"#方式一：图形化方式\" class=\"headerlink\" title=\"方式一：图形化方式\"></a>方式一：图形化方式</h3><ul>\n<li>计算机（点击鼠标右键）&#x3D;&#x3D;》管理（点击）&#x3D;&#x3D;》服务和应用程序（点击）&#x3D;&#x3D;》服务（点击）&#x3D;&#x3D;》MySQL57（点击鼠标右键）&#x3D;&#x3D;》启动或停止（点击）</li>\n<li>控制面板（点击）&#x3D;&#x3D;》系统和安全（点击）&#x3D;&#x3D;》管理工具（点击）&#x3D;&#x3D;》服务（点击）&#x3D;&#x3D;》MySQL57（点击鼠标右键）&#x3D;&#x3D;》启动或停止（点击）</li>\n<li>任务栏（点击鼠标右键）&#x3D;&#x3D;》启动任务管理器（点击）&#x3D;&#x3D;》服务（点击）&#x3D;&#x3D;》MySQL57（点击鼠标右键）&#x3D;&#x3D;》启动或停止（点击）</li>\n</ul>\n<h3 id=\"方式二：命令行方式\"><a href=\"#方式二：命令行方式\" class=\"headerlink\" title=\"方式二：命令行方式\"></a>方式二：命令行方式</h3><figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动 MySQL 服务命令：</span><br><span class=\"line\"><span class=\"built_in\">net</span> <span class=\"built_in\">start</span> MySQL57</span><br><span class=\"line\"></span><br><span class=\"line\">停止 MySQL 服务命令：</span><br><span class=\"line\"><span class=\"built_in\">net</span> stop MySQL57</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-MySQL数据库环境变量的配置\"><a href=\"#2-5-MySQL数据库环境变量的配置\" class=\"headerlink\" title=\"2.5 MySQL数据库环境变量的配置\"></a>2.5 MySQL数据库环境变量的配置</h2><table>\n<thead>\n<tr>\n<th align=\"center\">环境变量名</th>\n<th align=\"center\">操作</th>\n<th align=\"center\">环境变量值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">MYSQL_HOME</td>\n<td align=\"center\">新建</td>\n<td align=\"center\">D:\\develop\\MySQL\\MySQL Server 5.7</td>\n</tr>\n<tr>\n<td align=\"center\">path</td>\n<td align=\"center\">编辑</td>\n<td align=\"center\">%MYSQL_HOME%\\bin</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-6-MySQL数据库客户端的登录\"><a href=\"#2-6-MySQL数据库客户端的登录\" class=\"headerlink\" title=\"2.6 MySQL数据库客户端的登录\"></a>2.6 MySQL数据库客户端的登录</h2><h3 id=\"方式一：MySQL自带客户端\"><a href=\"#方式一：MySQL自带客户端\" class=\"headerlink\" title=\"方式一：MySQL自带客户端\"></a>方式一：MySQL自带客户端</h3><p>开始菜单&#x3D;&#x3D;》所有程序&#x3D;&#x3D;》MySQL&#x3D;&#x3D;》MySQL Server 5.7&#x3D;&#x3D;》MySQL 5.7 Command Line Client</p>\n<p><img src=\"/2021/06/30/mysql/1554910754482.png\" alt=\"1554910754482\"></p>\n<blockquote>\n<p>说明：仅限于root用户</p>\n</blockquote>\n<h3 id=\"方式二：命令行\"><a href=\"#方式二：命令行\" class=\"headerlink\" title=\"方式二：命令行\"></a>方式二：命令行</h3><p><strong>mysql -h 主机名 -P 端口号 -u 用户名 -p密码</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">例如：mysql <span class=\"operator\">-</span>h localhost <span class=\"operator\">-</span>P <span class=\"number\">3306</span> <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>proot   </span><br></pre></td></tr></table></figure>\n\n<p>注意：</p>\n<p>（1）-p与密码之间不能有空格，其他参数名与参数值之间可以有空格也可以没有空格</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>hlocalhost <span class=\"operator\">-</span>P3306 <span class=\"operator\">-</span>uroot <span class=\"operator\">-</span>proot</span><br></pre></td></tr></table></figure>\n\n<p>（2）密码建议在下一行输入</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>h localhost <span class=\"operator\">-</span>P <span class=\"number\">3306</span> <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br><span class=\"line\">Enter password:<span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span></span><br></pre></td></tr></table></figure>\n\n<p>（3）如果是连本机：-hlocalhost就可以省略，如果端口号没有修改：-P3306也可以省略</p>\n<p>  简写成：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>u root <span class=\"operator\">-</span>p</span><br><span class=\"line\">Enter password:<span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span><span class=\"operator\">*</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/06/30/mysql/1554910994523.png\" alt=\"1554910994523\"></p>\n<p>连接成功后，有关于MySQL Server服务版本的信息，还有第几次连接的id标识。</p>\n<p>也可以在命令行通过以下方式获取MySQL Server服务版本的信息</p>\n<p><img src=\"/2021/06/30/mysql/1554911047074.png\" alt=\"1554911047074\"></p>\n<p>或<strong>登录</strong>后，通过以下方式查看当前版本信息：0</p>\n<p><img src=\"/mysql%5Csnipaste_20210218_110332.png\" alt=\"snipaste_20210218_110332\"></p>\n<h3 id=\"方式三：可视化工具\"><a href=\"#方式三：可视化工具\" class=\"headerlink\" title=\"方式三：可视化工具\"></a>方式三：可视化工具</h3><p>例如：Navicat Preminum，SQLyog 等工具</p>\n<p>还有其他工具：mysqlfront,phpMyAdmin</p>\n<h4 id=\"SQLyog\"><a href=\"#SQLyog\" class=\"headerlink\" title=\"SQLyog\"></a>SQLyog</h4><p><img src=\"/2021/06/30/mysql/1554912367592.png\" alt=\"1554912367592\"></p>\n<p><img src=\"/2021/06/30/mysql/1554912376445.png\"></p>\n<h4 id=\"Navicat\"><a href=\"#Navicat\" class=\"headerlink\" title=\"Navicat\"></a>Navicat</h4><p><img src=\"/2021/06/30/mysql/1557378069584.png\"></p>\n<h2 id=\"2-7-MySQL数据库的编码配置\"><a href=\"#2-7-MySQL数据库的编码配置\" class=\"headerlink\" title=\"2.7 MySQL数据库的编码配置\"></a>2.7 MySQL数据库的编码配置</h2><p>查看编码命令</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;character_%&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;collation_%&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/06/30/mysql/MySQL%E7%BC%96%E7%A0%811.jpg\"></p>\n<p><img src=\"/2021/06/30/mysql/MySQL%E7%BC%96%E7%A0%812.jpg\"></p>\n<ul>\n<li>如果是以上配置不做任何修改</li>\n</ul>\n<h3 id=\"修改my-ini配置文件\"><a href=\"#修改my-ini配置文件\" class=\"headerlink\" title=\"修改my.ini配置文件\"></a>修改my.ini配置文件</h3><figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在路径：D:\\develop\\ProgramData\\MySQL\\MySQL Server 5.7 找到my.ini文件</span><br><span class=\"line\">修改内容1：</span><br><span class=\"line\">\t找到<span class=\"section\">[client]</span>配置，大概在62行左右，在其下一行添加 </span><br><span class=\"line\">\t\t<span class=\"attr\">default-character-set</span>=utf8</span><br><span class=\"line\">修改内容2：</span><br><span class=\"line\">\t找到<span class=\"section\">[mysql]</span>配置，大概在63行左右，在其下一行添加 </span><br><span class=\"line\">\t\t<span class=\"attr\">default-character-set</span>=utf8</span><br><span class=\"line\">修改内容3:</span><br><span class=\"line\">\t找到<span class=\"section\">[mysqld]</span>配置，大概在76行左右，在其下一行添加</span><br><span class=\"line\">\t\t<span class=\"attr\">character-set-server</span>=utf8</span><br><span class=\"line\">\t\t<span class=\"attr\">collation-server</span>=utf8_general_ci</span><br><span class=\"line\"></span><br><span class=\"line\">修改完毕后，重启MySQL57服务</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-mysql中的常见命令\"><a href=\"#2-8-mysql中的常见命令\" class=\"headerlink\" title=\"2.8 mysql中的常见命令\"></a>2.8 mysql中的常见命令</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span>查看数据库的版本</span><br><span class=\"line\">  <span class=\"keyword\">select</span> version();</span><br><span class=\"line\"><span class=\"number\">2.</span>显示数据库</span><br><span class=\"line\">  <span class=\"keyword\">show</span> databases;</span><br><span class=\"line\"><span class=\"number\">3.</span>显示数据库中的表;</span><br><span class=\"line\">  <span class=\"keyword\">show</span> tables;</span><br><span class=\"line\">  <span class=\"keyword\">show</span> tables <span class=\"keyword\">from</span> 库名;</span><br><span class=\"line\"><span class=\"number\">4.</span>使用<span class=\"operator\">/</span>切换数据库</span><br><span class=\"line\">  ues 库名;</span><br><span class=\"line\"><span class=\"number\">5.</span>显示当前正在使用的库;</span><br><span class=\"line\">  <span class=\"keyword\">select</span> database();</span><br><span class=\"line\"><span class=\"number\">6.</span>创建一张表</span><br><span class=\"line\">  <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名(</span><br><span class=\"line\">    字段名<span class=\"number\">1</span> 字段类行<span class=\"number\">1</span>,</span><br><span class=\"line\">    字段名<span class=\"number\">2</span> 字段类行<span class=\"number\">2</span>,</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    字段名n 字段类行n</span><br><span class=\"line\">   );</span><br><span class=\"line\"><span class=\"number\">7.</span>查看表的结构</span><br><span class=\"line\">  <span class=\"keyword\">desc</span> 表名;</span><br><span class=\"line\"><span class=\"number\">8.</span>查看表中的数据</span><br><span class=\"line\">  <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> 表名;</span><br><span class=\"line\"><span class=\"number\">9.</span>向表中插入数据</span><br><span class=\"line\">  <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> 表名(字段<span class=\"number\">1</span>，字段<span class=\"number\">2</span>，...字段n)<span class=\"keyword\">values</span>(数据值<span class=\"number\">1</span>,数据值<span class=\"number\">2</span>,....,数据值n);</span><br><span class=\"line\"><span class=\"number\">10.</span>修改数据</span><br><span class=\"line\">  <span class=\"keyword\">update</span> 表名 <span class=\"keyword\">set</span> 字段名<span class=\"operator\">=</span>数据值 [<span class=\"keyword\">where</span> 字段名<span class=\"operator\">=</span>数据值]</span><br><span class=\"line\"><span class=\"number\">11.</span>删除数据</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> 表名 [<span class=\"keyword\">where</span> 字段名<span class=\"operator\">=</span>数据值]</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"第三章-SQL概述\"><a href=\"#第三章-SQL概述\" class=\"headerlink\" title=\"第三章 SQL概述\"></a>第三章 SQL概述</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span>什么是<span class=\"keyword\">SQL</span>？</span><br><span class=\"line\">\tStructured Query <span class=\"keyword\">Language</span>：结构化查询语言</span><br><span class=\"line\">\t其实就是定义了操作所有关系型数据库的规则。每一种数据库操作的方式存在不一样的地方，称为“方言”。</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"number\">2.</span><span class=\"keyword\">SQL</span>通用语法</span><br><span class=\"line\">\t<span class=\"number\">1.</span> <span class=\"keyword\">SQL</span> 语句可以单行或多行书写，以分号结尾(建议关键字换行)。</span><br><span class=\"line\">\t<span class=\"number\">2.</span> 可使用空格和缩进来增强语句的可读性。</span><br><span class=\"line\">\t<span class=\"number\">3.</span> MySQL 数据库的 <span class=\"keyword\">SQL</span> 语句不区分大小写，关键字建议使用大写。</span><br><span class=\"line\">\t<span class=\"number\">4.</span> <span class=\"number\">3</span> 种注释</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 单行注释: <span class=\"comment\">-- 注释内容 或 # 注释内容(mysql 特有) </span></span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 多行注释: <span class=\"comment\">/* 注释 */</span></span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"number\">3.</span> <span class=\"keyword\">SQL</span>分类</span><br><span class=\"line\">\t<span class=\"number\">1</span>) DDL(Data Definition <span class=\"keyword\">Language</span>)数据定义语言</span><br><span class=\"line\">\t\t用来定义数据库对象：数据库，表，列等。关键字：<span class=\"keyword\">create</span>, <span class=\"keyword\">drop</span>,<span class=\"keyword\">alter</span> 等</span><br><span class=\"line\">\t<span class=\"number\">2</span>) DML(Data Manipulation <span class=\"keyword\">Language</span>)数据操作语言</span><br><span class=\"line\">\t\t用来对数据库中表的数据进行增删改。关键字：<span class=\"keyword\">insert</span>, <span class=\"keyword\">delete</span>, <span class=\"keyword\">update</span> 等</span><br><span class=\"line\">\t<span class=\"number\">3</span>) DQL(Data Query <span class=\"keyword\">Language</span>)数据查询语言</span><br><span class=\"line\">\t\t用来查询数据库中表的记录(数据)。关键字：<span class=\"keyword\">select</span>, <span class=\"keyword\">where</span> 等</span><br><span class=\"line\">\t<span class=\"number\">4</span>) DCL(Data Control <span class=\"keyword\">Language</span>)数据控制语言(了解)</span><br><span class=\"line\">\t\t用来定义数据库的访问权限和安全级别，及创建用户。关键字：<span class=\"keyword\">GRANT</span>， <span class=\"keyword\">REVOKE</span> 等</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第四章-DDL-操作数据库、表\"><a href=\"#第四章-DDL-操作数据库、表\" class=\"headerlink\" title=\"第四章 DDL:操作数据库、表\"></a>第四章 DDL:操作数据库、表</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 操作数据库：CRUD</span><br><span class=\"line\">\t<span class=\"number\">1.</span> C(<span class=\"keyword\">Create</span>):创建</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 创建数据库：</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">create</span> database 数据库名称;</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 创建数据库，判断不存在，再创建：</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> 数据库名称;</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 创建数据库，并指定字符集</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">create</span> database 数据库名称 <span class=\"type\">character</span> <span class=\"keyword\">set</span> 字符集名;</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 练习： 创建db4数据库，判断是否存在，并制定字符集为gbk</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">create</span> database if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> db4 <span class=\"type\">character</span> <span class=\"keyword\">set</span> gbk;\t\t</span><br><span class=\"line\">\t<span class=\"number\">2.</span> R(Retrieve)：查询</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 查询所有数据库的名称:</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">show</span> databases;</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 查询某个数据库的字符集:查询某个数据库的创建语句</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">show</span> <span class=\"keyword\">create</span> database 数据库名称;</span><br><span class=\"line\">\t<span class=\"number\">3.</span> U(<span class=\"keyword\">Update</span>):修改(不能修改数据库名)</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 修改数据库的字符集</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">alter</span> database 数据库名称 <span class=\"type\">character</span> <span class=\"keyword\">set</span> 字符集名称;</span><br><span class=\"line\">\t<span class=\"number\">4.</span> D(<span class=\"keyword\">Delete</span>):删除</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 删除数据库</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">drop</span> database 数据库名称;</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 判断数据库存在，存在再删除</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">drop</span> database if <span class=\"keyword\">exists</span> 数据库名称;</span><br><span class=\"line\">\t<span class=\"number\">5.</span> 使用数据库</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 查询当前正在使用的数据库名称</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">select</span> database();</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 使用数据库</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> use 数据库名称;</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2.</span> 操作表</span><br><span class=\"line\">\t<span class=\"number\">1.</span> C(<span class=\"keyword\">Create</span>):创建</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> 语法：</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名(</span><br><span class=\"line\">\t\t\t\t列名<span class=\"number\">1</span> 数据类型<span class=\"number\">1</span>,</span><br><span class=\"line\">\t\t\t\t列名<span class=\"number\">2</span> 数据类型<span class=\"number\">2</span>,</span><br><span class=\"line\">\t\t\t\t....</span><br><span class=\"line\">\t\t\t\t列名n 数据类型n</span><br><span class=\"line\">\t\t\t);</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 注意：最后一列，不需要加逗号（,）</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 数据类型：</span><br><span class=\"line\">\t\t\t\t<span class=\"number\">1.</span> <span class=\"type\">int</span>：整数类型</span><br><span class=\"line\">\t\t\t\t\t<span class=\"operator\">*</span> age <span class=\"type\">int</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"number\">2.</span> <span class=\"keyword\">double</span>:小数类型</span><br><span class=\"line\">\t\t\t\t\t<span class=\"operator\">*</span> score <span class=\"keyword\">double</span>(<span class=\"number\">7</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"number\">3.</span> <span class=\"type\">date</span>:日期，只包含年月日，yyyy<span class=\"operator\">-</span>MM<span class=\"operator\">-</span>dd</span><br><span class=\"line\">\t\t\t\t<span class=\"number\">4.</span> datetime:日期，包含年月日时分秒\t yyyy<span class=\"operator\">-</span>MM<span class=\"operator\">-</span>dd HH:mm:ss</span><br><span class=\"line\">\t\t\t\t<span class=\"number\">5.</span> <span class=\"type\">timestamp</span>:时间戳 类型\t包含年月日时分秒\t yyyy<span class=\"operator\">-</span>MM<span class=\"operator\">-</span>dd HH:mm:ss\t</span><br><span class=\"line\">\t\t\t\t\t<span class=\"operator\">*</span> 如果将来不给这个字段赋值，或赋值为<span class=\"keyword\">null</span>，则默认使用当前的系统时间，来自动赋值</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"number\">6.</span> <span class=\"type\">varchar</span>：字符串</span><br><span class=\"line\">\t\t\t\t\t<span class=\"operator\">*</span> name <span class=\"type\">varchar</span>(<span class=\"number\">20</span>):姓名最大<span class=\"number\">20</span>个字符</span><br><span class=\"line\">\t\t\t\t\t<span class=\"operator\">*</span> zhangsan <span class=\"number\">8</span>个字符  张三 <span class=\"number\">2</span>个字符</span><br></pre></td></tr></table></figure>\n\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t<span class=\"operator\">*</span> 创建表</span><br><span class=\"line\">\t\t<span class=\"keyword\">create</span> <span class=\"keyword\">table</span> student(</span><br><span class=\"line\">\t\t\tid <span class=\"type\">int</span>,</span><br><span class=\"line\">\t\t\tname <span class=\"type\">varchar</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">\t\t\tage <span class=\"type\">int</span> ,</span><br><span class=\"line\">\t\t\tscore <span class=\"keyword\">double</span>,</span><br><span class=\"line\">\t\t\tbirthday <span class=\"type\">date</span>,</span><br><span class=\"line\">\t\t\tinsert_time <span class=\"type\">timestamp</span></span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t</span><br><span class=\"line\">            <span class=\"operator\">*</span> <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> if <span class=\"keyword\">not</span> <span class=\"keyword\">exists</span> student(</span><br><span class=\"line\">\t\t\tid <span class=\"type\">int</span>,</span><br><span class=\"line\">\t\t\tname <span class=\"type\">varchar</span>(<span class=\"number\">32</span>),</span><br><span class=\"line\">\t\t\tage <span class=\"type\">int</span> ,</span><br><span class=\"line\">\t\t\tscore <span class=\"keyword\">double</span>,</span><br><span class=\"line\">\t\t\tbirthday <span class=\"type\">date</span>,</span><br><span class=\"line\">\t\t\tinsert_time <span class=\"type\">timestamp</span></span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 复制表：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">like</span> 被复制的表名;</span><br><span class=\"line\"><span class=\"number\">2.</span> R(Retrieve)：查询</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 查询某个数据库中所有的表名称</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">show</span> tables;</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 查询表结构</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">desc</span> 表名;</span><br><span class=\"line\"><span class=\"number\">3.</span> U(<span class=\"keyword\">Update</span>):修改</span><br><span class=\"line\">\t<span class=\"number\">1.</span> 修改表名</span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 rename <span class=\"keyword\">to</span> 新的表名;</span><br><span class=\"line\">\t<span class=\"number\">2.</span> 修改表的字符集</span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"type\">character</span> <span class=\"keyword\">set</span> 字符集名称;</span><br><span class=\"line\">\t<span class=\"number\">3.</span> 查看表的字符集</span><br><span class=\"line\">\t    <span class=\"keyword\">show</span> <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> 表名;</span><br><span class=\"line\">\t<span class=\"number\">4.</span> 添加一列</span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">add</span> 列名 数据类型;</span><br><span class=\"line\">\t<span class=\"number\">5.</span> 修改列名称 类型</span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 change 列名 新列名 新数据类型;  <span class=\"comment\">-- 修改列名和数据类型</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 modify 列名 新数据类型;   <span class=\"comment\">-- 只修改数据类型</span></span><br><span class=\"line\">\t<span class=\"number\">6.</span> 删除列</span><br><span class=\"line\">\t\t<span class=\"keyword\">alter</span> <span class=\"keyword\">table</span> 表名 <span class=\"keyword\">drop</span> 列名;</span><br><span class=\"line\"><span class=\"number\">4.</span> D(<span class=\"keyword\">Delete</span>):删除</span><br><span class=\"line\">\t<span class=\"operator\">*</span> <span class=\"keyword\">drop</span> <span class=\"keyword\">table</span> 表名;</span><br><span class=\"line\">\t<span class=\"operator\">*</span> <span class=\"keyword\">drop</span> <span class=\"keyword\">table</span>  if <span class=\"keyword\">exists</span> 表名 ;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>客户端图形化工具：Navicat</li>\n</ul>\n<h2 id=\"4-1-MySQL数据类型\"><a href=\"#4-1-MySQL数据类型\" class=\"headerlink\" title=\"4.1 MySQL数据类型\"></a>4.1 MySQL数据类型</h2><p>整型系列：xxxInt</p>\n<blockquote>\n<p>int(M)，必须和unsigned(数值类型无符号) zerofill(限制数字的位数)一起使用才有意义</p>\n</blockquote>\n<p><img src=\"/2021/06/30/mysql/1560933629123.png\" alt=\"1560933629123\"></p>\n<p>浮点型系列：float,double</p>\n<blockquote>\n<p>double(M,D)：表示最长为M位，其中小数点后D位      </p>\n<p>例如：double(5,2)表示的数据范围[-999.99,999.99]，如果超过这个范围会报错。</p>\n</blockquote>\n<p>定点型系列：decimal</p>\n<blockquote>\n<p>decimal(M,D)：表示最长为M位，其中小数点后D位</p>\n</blockquote>\n<p>字符串类型：char,varchar(M),text</p>\n<blockquote>\n<p>char如果没有指定宽度，默认为1个字符</p>\n<p>varchar(M)，必须指定宽度</p>\n</blockquote>\n<p>日期时间类型：year, date, datetime, timestamp  类似于Java里的java.sql.Date类 </p>\n<blockquote>\n<p>注意一下每一种日期时间的表示范围</p>\n</blockquote>\n<p>其他类型：bit, xxBlob, 枚举，集合等</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+----------------+--------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field          | Type         | Null | Key | Default | Extra          |</span><br><span class=\"line\">+----------------+--------------+------+-----+---------+----------------+</span><br><span class=\"line\">| eid            | int(11)      | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| ename          | varchar(20)  | NO   |     | NULL    |                |</span><br><span class=\"line\">| tel            | char(11)     | NO   |     | NULL    |                |</span><br><span class=\"line\">| gender         | char(1)      | YES  |     | 男        |                |</span><br><span class=\"line\">| salary         | double       | YES  |     | NULL    |                |</span><br><span class=\"line\">| commission_pct | double(3,2)  | YES  |     | NULL    |                |</span><br><span class=\"line\">| birthday       | date         | YES  |     | NULL    |                |</span><br><span class=\"line\">| hiredate       | date         | YES  |     | NULL    |                |</span><br><span class=\"line\">| job_id         | int(11)      | YES  |     | NULL    |                |</span><br><span class=\"line\">| email          | varchar(32)  | YES  |     | NULL    |                |</span><br><span class=\"line\">| mid            | int(11)      | YES  |     | NULL    |                |</span><br><span class=\"line\">| address        | varchar(150) | YES  |     | NULL    |                |</span><br><span class=\"line\">| native_place   | varchar(10)  | YES  |     | NULL    |                |</span><br><span class=\"line\">| did            | int(11)      | YES  |     | NULL    |                |</span><br><span class=\"line\">+----------------+--------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第五章-DML：增删改表中数据\"><a href=\"#第五章-DML：增删改表中数据\" class=\"headerlink\" title=\"第五章 DML：增删改表中数据\"></a>第五章 DML：增删改表中数据</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 添加数据：</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 语法：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> 表名(列名<span class=\"number\">1</span>,列名<span class=\"number\">2</span>,...列名n) <span class=\"keyword\">values</span>(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>,...值n);</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 注意：</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> 列名和值要一一对应。</span><br><span class=\"line\">\t\t<span class=\"number\">2.</span> 如果表名后，不定义列名，则默认给所有列添加值</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> 表名 <span class=\"keyword\">values</span>(值<span class=\"number\">1</span>,值<span class=\"number\">2</span>,...值n);</span><br><span class=\"line\">\t\t<span class=\"number\">3.</span> 除了数字类型，其他类型需要使用引号(单双都可以)引起来</span><br><span class=\"line\"><span class=\"number\">2.</span> 删除数据：</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 语法：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> 表名 [<span class=\"keyword\">where</span> 条件]</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 注意：</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> 如果不加条件，则删除表中所有记录。</span><br><span class=\"line\">\t\t<span class=\"number\">2.</span> 如果要删除所有记录</span><br><span class=\"line\">\t\t\t<span class=\"number\">1.</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> 表名; <span class=\"comment\">-- 不推荐使用。有多少条记录就会执行多少次删除操作</span></span><br><span class=\"line\">\t\t\t<span class=\"number\">2.</span> <span class=\"keyword\">truncate</span> <span class=\"keyword\">table</span> 表名; <span class=\"comment\">-- 推荐使用，效率更高 先删除表，然后再创建一张一样的表。</span></span><br><span class=\"line\"><span class=\"number\">3.</span> 修改数据：</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 语法：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> <span class=\"keyword\">update</span> 表名 <span class=\"keyword\">set</span> 列名<span class=\"number\">1</span> <span class=\"operator\">=</span> 值<span class=\"number\">1</span>, 列名<span class=\"number\">2</span> <span class=\"operator\">=</span> 值<span class=\"number\">2</span>,... [<span class=\"keyword\">where</span> 条件];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"operator\">*</span> 注意：</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> 如果不加任何条件，则会将表中所有记录全部修改。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第六章-DQL：查询表中的记录\"><a href=\"#第六章-DQL：查询表中的记录\" class=\"headerlink\" title=\"第六章 DQL：查询表中的记录\"></a>第六章 DQL：查询表中的记录</h1><h2 id=\"6-1-查询语句格式：\"><a href=\"#6-1-查询语句格式：\" class=\"headerlink\" title=\"6.1 查询语句格式：\"></a>6.1 查询语句格式：</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查询某张表中所有内容的时候：</span><br><span class=\"line\">\tselect * from 表名;</span><br><span class=\"line\"></span><br><span class=\"line\">1. 语法：</span><br><span class=\"line\">\tselect</span><br><span class=\"line\">\t\t字段列表</span><br><span class=\"line\">\tfrom</span><br><span class=\"line\">\t\t表名列表</span><br><span class=\"line\">\twhere</span><br><span class=\"line\">\t\t条件列表</span><br><span class=\"line\">\tgroup by</span><br><span class=\"line\">\t\t分组字段</span><br><span class=\"line\">\thaving</span><br><span class=\"line\">\t\t分组之后的条件</span><br><span class=\"line\">\torder by</span><br><span class=\"line\">\t\t排序</span><br><span class=\"line\">\tlimit</span><br><span class=\"line\">\t\t分页限定</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"相关-SQL-数据\"><a href=\"#相关-SQL-数据\" class=\"headerlink\" title=\"相关 SQL 数据\"></a>相关 SQL 数据</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> student3 ( </span><br><span class=\"line\">  id <span class=\"type\">int</span>,  <span class=\"comment\">-- 编号 </span></span><br><span class=\"line\">  name <span class=\"type\">varchar</span>(<span class=\"number\">20</span>), <span class=\"comment\">-- 姓名 </span></span><br><span class=\"line\">  age <span class=\"type\">int</span>, <span class=\"comment\">-- 年龄 </span></span><br><span class=\"line\">  sex <span class=\"type\">varchar</span>(<span class=\"number\">5</span>),  <span class=\"comment\">-- 性别 </span></span><br><span class=\"line\">  address <span class=\"type\">varchar</span>(<span class=\"number\">100</span>),  <span class=\"comment\">-- 地址 </span></span><br><span class=\"line\">  math <span class=\"type\">int</span>, <span class=\"comment\">-- 数学 </span></span><br><span class=\"line\">  english <span class=\"type\">int</span> <span class=\"comment\">-- 英语 </span></span><br><span class=\"line\">); </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> student(id,NAME,age,sex,address,math,english) <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>,<span class=\"string\">&#x27;马云&#x27;</span>,<span class=\"number\">55</span>,<span class=\"string\">&#x27;男&#x27;</span>, <span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">杭州&#x27;</span>,<span class=\"number\">66</span>,<span class=\"number\">78</span>),(<span class=\"number\">2</span>,<span class=\"string\">&#x27;马化腾&#x27;</span>,<span class=\"number\">45</span>,<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;深圳&#x27;</span>,<span class=\"number\">98</span>,<span class=\"number\">87</span>),(<span class=\"number\">3</span>,<span class=\"string\">&#x27;马景涛&#x27;</span>,<span class=\"number\">55</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;香港&#x27;</span>,<span class=\"number\">56</span>,<span class=\"number\">77</span>),(<span class=\"number\">4</span>,<span class=\"string\">&#x27;柳岩</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>,<span class=\"number\">20</span>,<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;湖南&#x27;</span>,<span class=\"number\">76</span>,<span class=\"number\">65</span>),(<span class=\"number\">5</span>,<span class=\"string\">&#x27;柳青&#x27;</span>,<span class=\"number\">20</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;湖南&#x27;</span>,<span class=\"number\">86</span>,<span class=\"keyword\">NULL</span>),(<span class=\"number\">6</span>,<span class=\"string\">&#x27;刘德华&#x27;</span>,<span class=\"number\">57</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;香港</span></span><br><span class=\"line\"><span class=\"string\">&#x27;</span>,<span class=\"number\">99</span>, <span class=\"number\">99</span>),(<span class=\"number\">7</span>,<span class=\"string\">&#x27;马德&#x27;</span>,<span class=\"number\">22</span>,<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;香港&#x27;</span>,<span class=\"number\">99</span>,<span class=\"number\">99</span>),(<span class=\"number\">8</span>,<span class=\"string\">&#x27;德玛西亚&#x27;</span>,<span class=\"number\">18</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;南京&#x27;</span>,<span class=\"number\">56</span>,<span class=\"number\">65</span>),(<span class=\"number\">9</span>,<span class=\"string\">&#x27;k_ing&#x27;</span>,<span class=\"number\">25</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;苏州&#x27;</span>,<span class=\"number\">100</span>,<span class=\"number\">100</span>);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-2-基础查询\"><a href=\"#6-2-基础查询\" class=\"headerlink\" title=\"6.2 基础查询\"></a>6.2 基础查询</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.语法</span><br><span class=\"line\">select 查询列表 from 表名;</span><br><span class=\"line\">类似于 System.out.println(打印的内容);</span><br><span class=\"line\">2.特点:</span><br><span class=\"line\"> 1.1 查询列表可以是:表中的字段，常量值，表达式，函数</span><br><span class=\"line\"> 1.2 查询的结果是一个虚拟的表格(没有将结果进行存储，而是打印后就结束了)</span><br><span class=\"line\">3.单个字段的查询</span><br><span class=\"line\">   select 列名 from 表名;</span><br><span class=\"line\">   select name from student;</span><br><span class=\"line\">4.多个字段的查询</span><br><span class=\"line\">\tselect 字段名1，字段名2... from 表名;</span><br><span class=\"line\">\tselect id,name,salary from student;\t\t</span><br><span class=\"line\">5.查询所有字段</span><br><span class=\"line\">   select * from 表名;</span><br><span class=\"line\">   select * from student;</span><br><span class=\"line\">   注: 在mysql里面可以使用 `` 将字段特殊含义去掉</span><br><span class=\"line\">   比如说 name 在sql里面是一个关键字，如果name是一个字段你得需要用 `name` 引起来</span><br><span class=\"line\">   select `name` from student;</span><br><span class=\"line\">6.查询常量值</span><br><span class=\"line\">   select 100;</span><br><span class=\"line\">   select &#x27;john&#x27;;</span><br><span class=\"line\">7.查询表达式</span><br><span class=\"line\">   select 100%98; </span><br><span class=\"line\">8.查询函数</span><br><span class=\"line\">   select VERSION();</span><br><span class=\"line\">9.起别名</span><br><span class=\"line\">   9.1 第一种方式 使用as</span><br><span class=\"line\">   select 100%98 as 结果;</span><br><span class=\"line\">   别名的好处</span><br><span class=\"line\">    1.便于理解</span><br><span class=\"line\">    2.便于区分</span><br><span class=\"line\">   9.2 第二种方式  使用空格</span><br><span class=\"line\">   select 100%98 结果</span><br><span class=\"line\">   注：特殊情况 如果你取的别名里 本身带有空格 需要用 &#x27;&#x27;</span><br><span class=\"line\">   比如 select 100%98 &#x27;结 果&#x27;;</span><br><span class=\"line\">10. 去除重复： distinct</span><br><span class=\"line\">\tselect distinct 字段名1，字段名2... from 表名；</span><br><span class=\"line\">\t案例:查询员学生表中涉及到的所有的地址</span><br><span class=\"line\">\tselect distinct address from student;</span><br><span class=\"line\">11. +号的作用</span><br><span class=\"line\">   在java +有两种含义</span><br><span class=\"line\">   1.运算符，两个操作数都是数值型</span><br><span class=\"line\">   2.连接符。只要有一个操作数为字符串</span><br><span class=\"line\">   在mysql +号</span><br><span class=\"line\">   仅仅只有一个功能:运算符</span><br><span class=\"line\">   select 100+90; 两个操作数都为数值型,则做加法运算</span><br><span class=\"line\">   select &#x27;123&#x27;+90; 213 其中一方为字符型，试图将字符型数值转换成数值型，如果转换成功则做加法运算</span><br><span class=\"line\">   select &#x27;join&#x27; +90; 90如果转换失败，则将字符型的值变成0</span><br><span class=\"line\">   select  null+&#x27;0&#x27;; 只要有一方值为null,结果必定为null</span><br><span class=\"line\">   注:如果想拼接字符串 可以使用函数 concat</span><br><span class=\"line\">   select concat(name,address) from student;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-3-条件查询\"><a href=\"#6-3-条件查询\" class=\"headerlink\" title=\"6.3 条件查询\"></a>6.3 条件查询</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.语法</span><br><span class=\"line\">  select </span><br><span class=\"line\">    查询列表</span><br><span class=\"line\">  from </span><br><span class=\"line\">     表名</span><br><span class=\"line\">  where </span><br><span class=\"line\">     筛选条件;</span><br><span class=\"line\">     </span><br><span class=\"line\">2.分类</span><br><span class=\"line\">  2.1.按条件表达式分类筛选</span><br><span class=\"line\">     条件运算符 : &gt; &lt; = != &lt;&gt; &lt;= &gt;=</span><br><span class=\"line\">     </span><br><span class=\"line\">  2.2 按逻辑表达式筛选</span><br><span class=\"line\">     作用:用于连接条件表达式</span><br><span class=\"line\">     逻辑运算符： &amp;&amp; || ！  and or not</span><br><span class=\"line\">     &amp;&amp;和and ：只要有两个条件为true,结果为true,反之为false</span><br><span class=\"line\">     ||和or  : 两个条件只要有一个true,结果为true,反之为false</span><br><span class=\"line\">     ！和 not : 将条件取反</span><br><span class=\"line\">     </span><br><span class=\"line\">  2.3 模糊查询</span><br><span class=\"line\">      like</span><br><span class=\"line\">      between and</span><br><span class=\"line\">      in</span><br><span class=\"line\">      is null</span><br><span class=\"line\">      </span><br><span class=\"line\">3. 按条件表达式筛选</span><br><span class=\"line\">   案例1： 查询年龄&gt;30岁的学生信息</span><br><span class=\"line\">   select * from student where age &gt;30;</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例2： 查询不住在杭州的学生姓名和地址</span><br><span class=\"line\">   select name,address from student where address != &#x27;杭州&#x27;; 建议使用</span><br><span class=\"line\">   select name,address from student where address &lt;&gt; &#x27;杭州&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">4.按逻辑表达式筛选</span><br><span class=\"line\">   案例1：查询数学分数大于80并且小于90分的学生姓名,年龄，和数学分数</span><br><span class=\"line\">\tselect name,age,math from student where math&gt;80 and math &lt;90; 建议使用</span><br><span class=\"line\">\tselect name,age,math from student where math&gt;80 &amp;&amp; math &lt;90;</span><br><span class=\"line\">\t</span><br><span class=\"line\">   案例2: 查询年龄不在20-30岁之间的学生，并且数学成绩大于90分的学生信息</span><br><span class=\"line\">   select * from student where age &lt;20 or age &gt;30 or math &gt;90;</span><br><span class=\"line\">   select * from student where not (age &gt;=20 and age &lt;=30) or math &gt;90;</span><br><span class=\"line\">5.模糊查询</span><br><span class=\"line\">   5.1 like 一般和通配符一起使用</span><br><span class=\"line\">   占位符介绍</span><br><span class=\"line\">   %:表示任意匹配字符（个数不限）</span><br><span class=\"line\">   _:代表一个任意字符(只占一个位置)</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例1：查询员工名中包含字符德的学生信息</span><br><span class=\"line\">   select * from student where name like &#x27;%德%&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例2: 查询员工中第二个字为德的人学生信息</span><br><span class=\"line\">   select * from student where name like &#x27;_德%&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例3: 查询员工中第二个字为德且名字长度为2的学生信息</span><br><span class=\"line\">   select * from student where name like &#x27;_德&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例4.查询员工中名字长度为3的学生信息</span><br><span class=\"line\">   select * from student where name like &#x27;___&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">   特殊情况:查询姓名中包含_的学生</span><br><span class=\"line\">   需要转义</span><br><span class=\"line\">   select * from student where name like &#x27;%\\_%&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">   5.2 between and</span><br><span class=\"line\">   在xxx之间 (从小到大)</span><br><span class=\"line\">   案例1：查询年龄在18 到 30 岁之间的学生信息</span><br><span class=\"line\">   select * from student where age &gt;=18 and age &lt;=30;</span><br><span class=\"line\">   </span><br><span class=\"line\">   select * from student where age between 18 and 30;</span><br><span class=\"line\">   以上两条语句完全等同</span><br><span class=\"line\">   5.3 in</span><br><span class=\"line\">   判断某字段的值是否属于in列表中的某一项(为了简洁,但不支持通配符)</span><br><span class=\"line\"></span><br><span class=\"line\">   案例1：查询住在 杭州, 香港，深圳的学生信息</span><br><span class=\"line\">   select * from student where address = &#x27;杭州&#x27; or address =&#x27;香港&#x27; or  address =&#x27;深圳&#x27;;</span><br><span class=\"line\">   select * from student where address in (&#x27;杭州&#x27;,&#x27;香港&#x27;,&#x27;深圳&#x27;);</span><br><span class=\"line\">   </span><br><span class=\"line\">   5.4 is null</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例1: 查询英语成绩为null的的学生姓名和地址</span><br><span class=\"line\">   </span><br><span class=\"line\">   select name , address from student where english =null;  -- 错误的 </span><br><span class=\"line\">   select name , address from student where english &lt;=&gt; null;  不建议</span><br><span class=\"line\">   select name , address from student where english is null ;</span><br><span class=\"line\">   </span><br><span class=\"line\">   案例2: 查询英语成绩不为null的的学生姓名和地址</span><br><span class=\"line\">   </span><br><span class=\"line\">   select name , address from student where english is not null ;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-4-排序查询\"><a href=\"#6-4-排序查询\" class=\"headerlink\" title=\"6.4 排序查询\"></a>6.4 排序查询</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.语法:</span><br><span class=\"line\">    select </span><br><span class=\"line\">      查询列表</span><br><span class=\"line\">    from</span><br><span class=\"line\">      表</span><br><span class=\"line\">    [where 筛选条件]</span><br><span class=\"line\">    order by 排序列表 [asc|desc]</span><br><span class=\"line\">* 排序方式：</span><br><span class=\"line\">\t* ASC：升序，默认的。</span><br><span class=\"line\">\t* DESC：降序。</span><br><span class=\"line\">* 注意：</span><br><span class=\"line\">\t* 如果有多个排序条件，则当前边的条件值一样时，才会判断第二条件。</span><br><span class=\"line\">  案例1:查询学生信息,要求按数学成绩从高到低排序</span><br><span class=\"line\">  select * from student order by math desc ;</span><br><span class=\"line\"></span><br><span class=\"line\">  案例2:查询学生信息, 要求按数学成绩从高到低排序，如果数学分数相同则按照英语成绩升序排序</span><br><span class=\"line\">  select * from student order by math desc,english asc;</span><br><span class=\"line\"></span><br><span class=\"line\">  案例3:查询男性学生信息 ，并按照数学成绩从高到低排序</span><br><span class=\"line\">  select * from student where sex =&#x27;男&#x27; order by math desc;</span><br><span class=\"line\"></span><br><span class=\"line\">  案例4:查询学生信心，要求按照总分从高到低排序</span><br><span class=\"line\">  select * ,math+english from student order by math+english desc;</span><br><span class=\"line\">  select * ,math+english as 总分 from student order by 总分 desc;</span><br><span class=\"line\"></span><br><span class=\"line\">  注:如何解决null值问题</span><br><span class=\"line\">  ifnull 函数</span><br><span class=\"line\">  语法</span><br><span class=\"line\">  ifnull(字段,值) 当字段中结果为null是，用值去替代,不为null的值就是原来的值</span><br><span class=\"line\">  select ifnull(english,0) from student;</span><br><span class=\"line\"></span><br><span class=\"line\">  案例4:完整的写法</span><br><span class=\"line\">  select *,math+ifnull(english,0) 总分 from  student order by 总分 desc;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-5-常见函数\"><a href=\"#6-5-常见函数\" class=\"headerlink\" title=\"6.5 常见函数\"></a>6.5 常见函数</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">概念：类似于java的方法,将一组逻辑语句封装的方法体重，对外暴露方法名</span><br><span class=\"line\">好处：1.隐藏了实现细节 2.提高代码的重用行</span><br><span class=\"line\">调用：select 函数名(实参列表) [from 表]</span><br><span class=\"line\">重点: 叫什么(函数名)，干什么(函数功能)</span><br><span class=\"line\">分类</span><br><span class=\"line\">   1.单行函数(给进去一些值，结果返回一个)</span><br><span class=\"line\">   比如 concat,ifnull,length</span><br><span class=\"line\">   2.分组函数(聚合函数)</span><br><span class=\"line\">   功能:做统计使用</span><br><span class=\"line\">1.单行函数（字符函数，数字函数，日期函数，流程控制函数，其他函数）</span><br><span class=\"line\">1.1 字符函数</span><br><span class=\"line\">  1.1.1  length 获取参数值的字节个数（需要考虑字符集）</span><br><span class=\"line\">          select length(&#x27;john&#x27;);</span><br><span class=\"line\">  1.1.2  concat 拼接字符串</span><br><span class=\"line\">         select concat (name,&#x27;_&#x27;,age) from student;</span><br><span class=\"line\">  1.1.3  upper（转大写） ,lower（转小写）</span><br><span class=\"line\">         select upper(&#x27;john&#x27;);</span><br><span class=\"line\">         select lower(&#x27;JOHN&#x27;);</span><br><span class=\"line\">         案例：将姓大写名小写 然后进行拼接</span><br><span class=\"line\">         select  concat(upper(&#x27;nihao&#x27;),lower(&#x27;zaijian&#x27;));</span><br><span class=\"line\">  1.1.4 substr 截取字符串 在sql中索引从1开始</span><br><span class=\"line\">         select substr(&#x27;2020-08-08&#x27;,1,4);</span><br><span class=\"line\">         select substr(&#x27;李莫愁爱上了陆展元&#x27;,7,3);</span><br><span class=\"line\">  1.1.5  instr (子串在大字符串里的第一次的出现起始索引，如果没有返回0)</span><br><span class=\"line\">         select instr(&#x27;杨不悔爱上了殷六侠&#x27;,&#x27;殷六侠&#x27;);</span><br><span class=\"line\">  1.1.6  trim 前后去字符</span><br><span class=\"line\">         select trim(&#x27;       张翠山      &#x27;);</span><br><span class=\"line\">         select trim(&#x27;a&#x27; from &#x27;aaaaaa张aaaa翠山aaaaaa&#x27;);</span><br><span class=\"line\">  1.1.6  lpad，rpad（向左或者向右补全）</span><br><span class=\"line\">         select lpad(&#x27;nihao&#x27;,10,&#x27;a&#x27;);</span><br><span class=\"line\">         select rpad(&#x27;nihao&#x27;,10,&#x27;a&#x27;);</span><br><span class=\"line\">  1.1.7  replace 替换</span><br><span class=\"line\">         select replace(&#x27;张无忌爱上的了周芷若&#x27;,&#x27;周芷若&#x27;,&#x27;赵敏&#x27;);</span><br><span class=\"line\">1.2 数学函数</span><br><span class=\"line\">  1.2.1 round 四舍五入</span><br><span class=\"line\">        select round(1.5);</span><br><span class=\"line\">        select round(1.567,2);</span><br><span class=\"line\">  1.2.2 ceil  向上取整，返回&gt;=该参数的最小整数</span><br><span class=\"line\">        select ceil(1.1); </span><br><span class=\"line\">  1.2.3 floor 向下取整， 返回&lt;=该参数的最大整数</span><br><span class=\"line\">        select floor(1.9);</span><br><span class=\"line\">  1.2.4 truncate 截断</span><br><span class=\"line\">        select truncate(1.69999,2);</span><br><span class=\"line\">  1.2.5 mod 取余   a-a/b*b</span><br><span class=\"line\">        select mod(10,3);</span><br><span class=\"line\">        select 10%3;</span><br><span class=\"line\">1.3 日期函数</span><br><span class=\"line\">   1.3.1 now 返回当前系统日期+时间</span><br><span class=\"line\">   select now();</span><br><span class=\"line\">   1.3.2 currdate 返回当前系统日期</span><br><span class=\"line\">   select curdate();</span><br><span class=\"line\">   1.3.3 获取指定的部分 ,年(year),月(month),天(day),小时(hour),分钟(minute),秒(second)</span><br><span class=\"line\">   select year(now());</span><br><span class=\"line\">   select month(&#x27;1999-09-09&#x27;);</span><br><span class=\"line\">   1.3.4 str_to_date:将日期格式的字符转换成指定格式的日期</span><br><span class=\"line\">   select str_to_date(&#x27;9-13-2004&#x27;,&#x27;%m-%d-%Y&#x27;)</span><br><span class=\"line\">   1.3.5 date_format:将日期转化成字符串</span><br><span class=\"line\">   select date_format(&#x27;2020-01-01&#x27;,&#x27;%Y年/%m月/%d日&#x27;);</span><br><span class=\"line\">1.4 其他函数</span><br><span class=\"line\">   1.4.1 select VERSION();</span><br><span class=\"line\">   1.4.2 select database();</span><br><span class=\"line\">   1.4.3 select user();</span><br><span class=\"line\">1.5 流程控制函数</span><br><span class=\"line\">   1.5.1.if 函数 类似于if else</span><br><span class=\"line\">   select if(条件表达式,true 执行这个, false 执行这个)</span><br><span class=\"line\">   select if(10&gt;5,&#x27;大于&#x27;,&#x27;小于&#x27;)</span><br><span class=\"line\">   select if(english is null ,&#x27;我没考英语&#x27;,&#x27;我考了英语&#x27;) from student;</span><br><span class=\"line\">   1.5.2 case 函数 类似于 switch case</span><br><span class=\"line\">   case 要判断的字段或表达式</span><br><span class=\"line\">   when 常量1 then 显示的值1</span><br><span class=\"line\">   when 常量2 then 显示的值2</span><br><span class=\"line\">   else 要显示的值n</span><br><span class=\"line\">   end</span><br><span class=\"line\">   案例 根据不同的地区，将数学分数乘以不同的系数(杭州 1.1 深圳 1.2 香港 1.3 其他不变)</span><br><span class=\"line\">   select address,case address when &#x27;杭州&#x27; then math * 1.1  when &#x27;深圳&#x27; then math * 1.2 when &#x27;香港&#x27; then math * 1.3 else math end from student;</span><br><span class=\"line\">2.分组函数(聚合函数)</span><br><span class=\"line\">  做统计使用</span><br><span class=\"line\">   2.1. count：计算个(行数)数</span><br><span class=\"line\">\t   1. 一般选择非空的列：主键</span><br><span class=\"line\">\t   2. count(*)</span><br><span class=\"line\">       select count(math) from student;\t</span><br><span class=\"line\">   2.2 max：计算最大值</span><br><span class=\"line\">        select max(math) from student;</span><br><span class=\"line\">   2.3 min：计算最小值</span><br><span class=\"line\">        select min(math) from student;</span><br><span class=\"line\">   2.4. sum：计算和</span><br><span class=\"line\">       select max(math) from student;</span><br><span class=\"line\">   2.5. avg：计算平均值</span><br><span class=\"line\">       select avg(math) from student;</span><br><span class=\"line\">   2.6 参数支持哪些类型</span><br><span class=\"line\">   sum(),avg() 数值型</span><br><span class=\"line\">   min(),max(),count() 数值和字符都可以</span><br><span class=\"line\">   </span><br><span class=\"line\">   -- 注意：所有聚合函数的计算，排除null值。</span><br><span class=\"line\">\t-- 解决方案：</span><br><span class=\"line\">\t\t-- 1. 选择不包含非空的列进行计算</span><br><span class=\"line\">\t\t-- 2. IFNULL函数</span><br><span class=\"line\">   2.7 可以和distinct 搭配使用</span><br><span class=\"line\">   select sum(distinct math),sum(math) from student;</span><br><span class=\"line\">   select count(distinct math),count(math) from student;</span><br><span class=\"line\">   </span><br><span class=\"line\">   2.8 和分组函数一同查询的字段有限制,一般来说是group by之后的字段</span><br><span class=\"line\">   select sum(math),name from student; -- 没有意义</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/mysql%5Csnipaste_20210222_152326.png\" alt=\"snipaste_20210222_152326\"></p>\n<h2 id=\"6-6-分组查询\"><a href=\"#6-6-分组查询\" class=\"headerlink\" title=\"6.6 分组查询\"></a>6.6 分组查询</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.语法</span><br><span class=\"line\">   select 分组函数,列(要求出现在group by 后面)</span><br><span class=\"line\">   from 表</span><br><span class=\"line\">   [where 筛选条件]</span><br><span class=\"line\">   group by 分组列表</span><br><span class=\"line\">   [having 筛选条件]</span><br><span class=\"line\">   [order by 排序列表]</span><br><span class=\"line\">2. 注意：</span><br><span class=\"line\">\t1. 分组之后查询的字段：分组字段、聚合函数</span><br><span class=\"line\">\t2. where 和 having 的区别？</span><br><span class=\"line\">\t\t1. where 在分组之前进行限定，如果不满足条件，则不参与分组。having在分组之后进行限定，如果不满足结果，则不会被查询出来</span><br><span class=\"line\">\t\t2. where 后不可以跟聚合函数，having可以进行聚合函数的判断。</span><br><span class=\"line\">案例1:查询不同性别的数学最高分和英语最高分</span><br><span class=\"line\">    select sex,max(math),max(english) from student group by sex;</span><br><span class=\"line\">    </span><br><span class=\"line\">案例2：统计不同地区的学生个数    </span><br><span class=\"line\">\tselect address,count(*) from student group by address;</span><br><span class=\"line\"></span><br><span class=\"line\">案例3:统计来自香港的学生并按照性别求出数学平均分</span><br><span class=\"line\">    select sex,avg(math) from student where address =&#x27;香港&#x27; group by sex; </span><br><span class=\"line\">    </span><br><span class=\"line\">案例4:统计不同地区，不同性别学生的数学平均分</span><br><span class=\"line\">    select address,sex,avg(math) from student group by address,sex;</span><br><span class=\"line\">    </span><br><span class=\"line\">案例5:统计不同地区学生的数学平均分并要求平均分大于80</span><br><span class=\"line\">   select address,avg(math) as math_avg from student group by address having math_avg &gt;80;</span><br><span class=\"line\">   </span><br><span class=\"line\">案例6：统计来自香港的学生按照性别求数学平均分，并要求平均分大于80</span><br><span class=\"line\">   第一种 select  sex, avg(math) math_avg from student where address=&#x27;香港&#x27; group by sex having math_avg &gt;80;  </span><br><span class=\"line\">   第二种 select address,sex, avg(math) math_avg  from student group by address,sex having math_avg &gt;80 and address=&#x27;香港&#x27;;</span><br><span class=\"line\">   </span><br><span class=\"line\">案例7：按学生姓名的长度分组，统计每一组学生个数（group by 后面可以接函数）</span><br><span class=\"line\">   select length(name),count(*)  from student group by length(name);</span><br><span class=\"line\">   </span><br><span class=\"line\">案例8:统计不同地区，不同性别学生的数学平均分，并且要求按照数学平均分从大到小排序</span><br><span class=\"line\">  select  address ,sex,avg(math) math_avg from student group by address,sex order by math_avg desc;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-7-分页查询\"><a href=\"#6-7-分页查询\" class=\"headerlink\" title=\"6.7 分页查询\"></a>6.7 分页查询</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 语法：</span><br><span class=\"line\">\tselect</span><br><span class=\"line\">\t\t字段列表</span><br><span class=\"line\">\tfrom</span><br><span class=\"line\">\t\t表名列表</span><br><span class=\"line\">\t[where</span><br><span class=\"line\">\t\t条件列表]s</span><br><span class=\"line\">\t[group by</span><br><span class=\"line\">\t\t分组字段]</span><br><span class=\"line\">\t[having</span><br><span class=\"line\">\t\t分组之后的条件]</span><br><span class=\"line\">\t[order by</span><br><span class=\"line\">\t\t排序]</span><br><span class=\"line\">\tlimit</span><br><span class=\"line\">\t\t分页限定</span><br><span class=\"line\">案例1:显示前3条学生信息\t\t</span><br><span class=\"line\">\tSELECT * FROM student LIMIT 0,3; </span><br><span class=\"line\">案例2:显示数学成绩前3的学生信息</span><br><span class=\"line\">    select * from student order by math limit 0,3;</span><br><span class=\"line\">2. 公式：开始的索引 = （当前的页码 - 1） * 每页显示的条数\t</span><br><span class=\"line\">3. limit 是一个MySQL&quot;方言&quot;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"执行顺序\"><a href=\"#执行顺序\" class=\"headerlink\" title=\"执行顺序\"></a>执行顺序</h5><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> <span class=\"operator\">&gt;</span> <span class=\"keyword\">where</span> <span class=\"operator\">&gt;</span> <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> <span class=\"operator\">&gt;</span> 分组函数 <span class=\"operator\">&gt;</span> <span class=\"keyword\">having</span> <span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">&gt;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> <span class=\"operator\">&gt;</span> limit</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"第七章-多表查询\"><a href=\"#第七章-多表查询\" class=\"headerlink\" title=\"第七章 多表查询\"></a>第七章 多表查询</h1><ul>\n<li><p>查询语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select</span><br><span class=\"line\">\t列名列表</span><br><span class=\"line\">from</span><br><span class=\"line\">\t表名列表</span><br><span class=\"line\">where....</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"准备SQL-数据\"><a href=\"#准备SQL-数据\" class=\"headerlink\" title=\"准备SQL 数据\"></a>准备SQL 数据</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 创建部门表</span><br><span class=\"line\">\tCREATE TABLE dept(</span><br><span class=\"line\">\t\tid INT ,</span><br><span class=\"line\">\t\tNAME VARCHAR(20),</span><br><span class=\"line\">        location_id int</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tINSERT INTO dept (id,NAME,location_id) VALUES (1,&#x27;开发部&#x27;,1),(2,&#x27;市场部&#x27;,2),(3,&#x27;财务部&#x27;,3);</span><br><span class=\"line\"># 创建位置表</span><br><span class=\"line\">    create table location(</span><br><span class=\"line\">       id int,</span><br><span class=\"line\">       location_name varchar(25)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    insert into location(id,location_name) values(1,&#x27;北京&#x27;),(2,&#x27;深圳&#x27;),(3,&#x27;上海&#x27;);</span><br><span class=\"line\"># 创建员工表</span><br><span class=\"line\">\tCREATE TABLE emp (</span><br><span class=\"line\">\t\tid INT ,</span><br><span class=\"line\">\t\tNAME VARCHAR(10),</span><br><span class=\"line\">\t\tgender CHAR(1), -- 性别</span><br><span class=\"line\">\t\tsalary DOUBLE, -- 工资</span><br><span class=\"line\">\t\tjoin_date DATE, -- 入职日期</span><br><span class=\"line\">\t\tdept_id INT</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\tINSERT INTO emp(id,NAME,gender,salary,join_date,dept_id) VALUES(1,&#x27;孙悟空&#x27;,&#x27;男&#x27;,7200,&#x27;2013-02-24&#x27;,1);</span><br><span class=\"line\">\tINSERT INTO emp(id,NAME,gender,salary,join_date,dept_id) VALUES(2,&#x27;猪八戒&#x27;,&#x27;男&#x27;,3600,&#x27;2010-12-02&#x27;,2);</span><br><span class=\"line\">\tINSERT INTO emp(id,NAME,gender,salary,join_date,dept_id) VALUES(3,&#x27;唐僧&#x27;,&#x27;男&#x27;,9000,&#x27;2008-08-08&#x27;,2);</span><br><span class=\"line\">\tINSERT INTO emp(id,NAME,gender,salary,join_date,dept_id) VALUES(4,&#x27;白骨精&#x27;,&#x27;女&#x27;,5000,&#x27;2015-10-07&#x27;,3);</span><br><span class=\"line\">\tINSERT INTO emp(id,NAME,gender,salary,join_date,dept_id) VALUES(5,&#x27;蜘蛛精&#x27;,&#x27;女&#x27;,4500,&#x27;2011-03-14&#x27;,1);</span><br><span class=\"line\">#创建薪水等级表\t</span><br><span class=\"line\">   create table salary_level(</span><br><span class=\"line\">     salary_level varchar(3),</span><br><span class=\"line\">     lowest_sal int,</span><br><span class=\"line\">     highest_sal int</span><br><span class=\"line\">   );</span><br><span class=\"line\">   </span><br><span class=\"line\">   insert into salary_level values(&#x27;A&#x27;,2000,4000);</span><br><span class=\"line\">   insert into salary_level values(&#x27;B&#x27;,4000,6000);</span><br><span class=\"line\">   insert into salary_level values(&#x27;C&#x27;,6000,8000);</span><br><span class=\"line\">   insert into salary_level values(&#x27;D&#x27;,8000,10000);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>笛卡尔积：</p>\n<ul>\n<li>有两个集合A,B .取这两个集合的所有组成情况。</li>\n<li>要完成多表查询，需要消除无用的数据</li>\n</ul>\n</li>\n<li><p>分类</p>\n<ul>\n<li><p>内连接查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  1. 隐式内连接：使用where条件消除无用数据(sql92)</span><br><span class=\"line\">  \t案例1.查询所有员工信息和对应的部门信息</span><br><span class=\"line\">  \tSELECT * FROM emp,dept WHERE emp.dept_id = dept.id;</span><br><span class=\"line\">  \t\t\t</span><br><span class=\"line\">  \t案例2.查询员工表的名称，性别,部门名称</span><br><span class=\"line\">  \tSELECT emp.name,emp.gender,dept.name FROM emp,dept WHERE emp.`dept_id` = dept.`id`;</span><br><span class=\"line\">  \t标准格式\t\t</span><br><span class=\"line\">  \tSELECT </span><br><span class=\"line\">  \t\tt1.name, -- 员工表的姓名</span><br><span class=\"line\">  \t\tt1.gender,-- 员工表的性别</span><br><span class=\"line\">  \t\tt2.name -- 部门表的名称</span><br><span class=\"line\">  \tFROM</span><br><span class=\"line\">  \t\temp t1,</span><br><span class=\"line\">  \t\tdept t2</span><br><span class=\"line\">  \tWHERE </span><br><span class=\"line\">  \t\tt1.`dept_id` = t2.`id`;</span><br><span class=\"line\">  \t案例3.查询所有男性员工的名称，性别,部门名称</span><br><span class=\"line\">  \tselect   e.name,e.gender,d.name from emp e ,dept d where e.dept_id=d.id and e.gender=&#x27;男&#x27;;</span><br><span class=\"line\">  \t 将连接键和条件筛选放到了一起，可读性较差</span><br><span class=\"line\">  2. 显式内连接(sql99)：</span><br><span class=\"line\">  \t语法： select 字段列表 from 表名1 [inner] join 表名2 on 条件</span><br><span class=\"line\">  \tSELECT * FROM emp INNER JOIN dept ON emp.`dept_id` = dept.`id`;\t</span><br><span class=\"line\">  \tSELECT * FROM emp JOIN dept ON emp.`dept_id` = dept.`id`;</span><br><span class=\"line\">      案例1.查询所有男性员工的名称，性别,部门名称</span><br><span class=\"line\">      select e.name,e.gender,d.name from emp e join dept d on e.dept_id=d.id where e.gender=&#x27;男&#x27;;</span><br><span class=\"line\">      案例2.统计员工的平均工资，按照部门名称分组，并且按平均工资从高到低排序</span><br><span class=\"line\">      select d.name ,avg(salary) salary_avg from emp e join dept d on e.dept_id=d.id  group by d.name order by salary_avg desc;</span><br><span class=\"line\">注：上述所有的都是等值连接，然后还有非等值连接 </span><br><span class=\"line\">  案例1:求每个人的薪资级别</span><br><span class=\"line\">   select e.name,e.salary,s.salary_level from emp e join salary_level s on e.salary&gt;=s.lowest_sal and e.salary&lt;=s.highest_sal;</span><br><span class=\"line\">  3. 连接查询的重点：</span><br><span class=\"line\">  \t从哪些表中查询数据</span><br><span class=\"line\">  \t条件是什么</span><br><span class=\"line\">  \t查询哪些字段</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>外链接查询</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 1. 左外连接：</span><br><span class=\"line\"> \t语法：select 字段列表 from 表1 left [outer] join 表2 on 条件；</span><br><span class=\"line\"> \t查询的是左表所有数据以及其交集部分。</span><br><span class=\"line\">-- 查询所有员工信息，如果员工有部门，则查询部门名称，没有部门，则不显示部门名称</span><br><span class=\"line\"> \tSELECT \tt1.*,t2.`name` FROM emp t1 LEFT JOIN dept t2 ON t1.`dept_id` = t2.`id`;</span><br><span class=\"line\"></span><br><span class=\"line\"> 2. 右外连接：</span><br><span class=\"line\"> \t语法：select 字段列表 from 表1 right [outer] join 表2 on 条件；</span><br><span class=\"line\"> \t查询的是右表所有数据以及其交集部分。</span><br><span class=\"line\"> \tSELECT \t* FROM dept t2 RIGHT JOIN emp t1 ON t1.`dept_id` = t2.`id`;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>子查询：查询中嵌套查询，称嵌套查询为子查询。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 查询工资最高的员工信息</span><br><span class=\"line\">-- 1 查询最高的工资是多少 9000</span><br><span class=\"line\">SELECT MAX(salary) FROM emp;</span><br><span class=\"line\">\t\t\t</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>– 2 查询员工信息，并且工资等于9000的</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp <span class=\"keyword\">WHERE</span> emp.`salary` <span class=\"operator\">=</span> <span class=\"number\">9000</span>;</span><br></pre></td></tr></table></figure>\n\n\n<p>  – 一条sql就完成这个操作。子查询</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp <span class=\"keyword\">WHERE</span> emp.`salary` <span class=\"operator\">=</span> (<span class=\"keyword\">SELECT</span> <span class=\"built_in\">MAX</span>(salary) <span class=\"keyword\">FROM</span> emp);</span><br></pre></td></tr></table></figure>\n\n\n\n\n  <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\">*</span> 子查询不同情况</span><br><span class=\"line\"></span><br><span class=\"line\">​```mysql</span><br><span class=\"line\"><span class=\"number\">1.</span> 子查询的结果是单行单列的：</span><br><span class=\"line\">\t子查询可以作为条件，使用运算符去判断。 运算符： <span class=\"operator\">&gt;</span> <span class=\"operator\">&gt;=</span> <span class=\"operator\">&lt;</span> <span class=\"operator\">&lt;=</span> <span class=\"operator\">=</span></span><br><span class=\"line\">\t<span class=\"comment\">-- 查询员工工资小于平均工资的人</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp <span class=\"keyword\">WHERE</span> emp.salary <span class=\"operator\">&lt;</span> (<span class=\"keyword\">SELECT</span> <span class=\"built_in\">AVG</span>(salary) <span class=\"keyword\">FROM</span> emp);</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"number\">2.</span> 子查询的结果是多行单列的：</span><br><span class=\"line\">\t子查询可以作为条件，使用运算符<span class=\"keyword\">in</span>来判断</span><br><span class=\"line\">\t<span class=\"comment\">-- 查询&#x27;财务部&#x27;和&#x27;市场部&#x27;所有的员工信息</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> id <span class=\"keyword\">FROM</span> dept <span class=\"keyword\">WHERE</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;财务部&#x27;</span> <span class=\"keyword\">OR</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;市场部&#x27;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp <span class=\"keyword\">WHERE</span> dept_id <span class=\"operator\">=</span> <span class=\"number\">3</span> <span class=\"keyword\">OR</span> dept_id <span class=\"operator\">=</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"comment\">-- 子查询</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp <span class=\"keyword\">WHERE</span> dept_id <span class=\"keyword\">IN</span> (<span class=\"keyword\">SELECT</span> id <span class=\"keyword\">FROM</span> dept <span class=\"keyword\">WHERE</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;财务部&#x27;</span> <span class=\"keyword\">OR</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;市场部&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">3.</span> 子查询的结果是多行多列的：</span><br><span class=\"line\">\t子查询可以作为一张虚拟表参与查询</span><br><span class=\"line\">\t<span class=\"comment\">-- 查询员工入职日期是2011-11-11日之后的员工信息和部门信息</span></span><br><span class=\"line\">\t<span class=\"comment\">-- 子查询</span></span><br><span class=\"line\">\t<span class=\"keyword\">select</span>  t1.id,.t1.name,t1.join_date,d.name <span class=\"keyword\">from</span> dept d <span class=\"keyword\">join</span> (<span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp <span class=\"keyword\">where</span> join_date <span class=\"operator\">&lt;</span> <span class=\"string\">&#x27;2011-11-11&#x27;</span>) t1 <span class=\"keyword\">ON</span> d.id<span class=\"operator\">=</span>t1.dept_id;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">\t<span class=\"comment\">-- 普通内连接</span></span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> emp t1,dept t2 <span class=\"keyword\">WHERE</span> t1.`dept_id` <span class=\"operator\">=</span> t2.`id` <span class=\"keyword\">AND</span> t1.`join_date` <span class=\"operator\">&gt;</span>  <span class=\"string\">&#x27;2011-11-11&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> emp e <span class=\"keyword\">join</span> dept d <span class=\"keyword\">on</span> e.dept_id <span class=\"operator\">=</span> d.id <span class=\"keyword\">where</span> e.join_date <span class=\"operator\">&gt;</span> <span class=\"string\">&#x27;2011-11-11&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id><a href=\"#\" class=\"headerlink\" title></a></h1><h1 id=\"第八章-约束\"><a href=\"#第八章-约束\" class=\"headerlink\" title=\"第八章 约束\"></a>第八章 约束</h1><ul>\n<li>约束：对表中的数据进行限定，保证数据的正确性、有效性和完整性。</li>\n<li>分类：<ul>\n<li>主键约束：primary key</li>\n<li>非空约束：not null</li>\n<li>唯一约束：unique</li>\n<li>外键约束：foreign key</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"7-1-非空约束\"><a href=\"#7-1-非空约束\" class=\"headerlink\" title=\"7.1 非空约束\"></a>7.1 非空约束</h2><ul>\n<li><p>非空约束：not null，某一列的值不能为null</p>\n</li>\n<li><p>创建表时添加约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE stu(</span><br><span class=\"line\">\tid INT,</span><br><span class=\"line\">\tNAME VARCHAR(20) NOT NULL -- name为非空</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建表完后，添加非空约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE stu MODIFY NAME VARCHAR(20) NOT NULL;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>删除name的非空约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE stu MODIFY NAME VARCHAR(20);</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"7-2-唯一约束\"><a href=\"#7-2-唯一约束\" class=\"headerlink\" title=\"7.2 唯一约束\"></a>7.2 唯一约束</h2><ul>\n<li><p>唯一约束：unique，某一列的值不能重复</p>\n</li>\n<li><p>注意：唯一约束可以有NULL值，但是只能有一条记录为null</p>\n</li>\n<li><p>在创建表时，添加唯一约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE stu(</span><br><span class=\"line\">\tid INT,</span><br><span class=\"line\">\tphone_number VARCHAR(20) UNIQUE -- 手机号</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>删除唯一约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE stu DROP INDEX unique_name;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在表创建完后，添加唯一约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一种方式</span><br><span class=\"line\">ALTER TABLE stu MODIFY phone_number VARCHAR(20) UNIQUE;</span><br><span class=\"line\">第二种方式</span><br><span class=\"line\">alter table stu add constraint &lt;unique_name&gt; unique(列名);</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"7-3-主键约束\"><a href=\"#7-3-主键约束\" class=\"headerlink\" title=\"7.3 主键约束\"></a>7.3 主键约束</h2><ul>\n<li><p>主键约束：primary key</p>\n</li>\n<li><p>注意事项：</p>\n<ul>\n<li>含义：非空且唯一</li>\n<li>一张表只能有一个字段为主键</li>\n<li>主键就是表中每行数据的唯一标识</li>\n</ul>\n</li>\n<li><p>在创建表时，添加主键约束</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create table stu(</span><br><span class=\"line\">\tid int primary key,-- 给id添加主键约束</span><br><span class=\"line\">\tname varchar(20)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>删除主键</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 错误 alter table stu modify id int ;</span><br><span class=\"line\">ALTER TABLE stu DROP PRIMARY KEY;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建完表后，添加主键</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE stu MODIFY id INT PRIMARY KEY;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>自动增长</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.  概念：如果某一列是数值类型的，使用 auto_increment 可以来完成值得自动增长</span><br><span class=\"line\"></span><br><span class=\"line\">2. 在创建表时，添加主键约束，并且完成主键自增长</span><br><span class=\"line\">\tcreate table stu(</span><br><span class=\"line\">\t\tid int primary key auto_increment,-- 给id添加主键约束</span><br><span class=\"line\">\t\tname varchar(20)</span><br><span class=\"line\">\t);</span><br><span class=\"line\">3. 删除自动增长</span><br><span class=\"line\">\tALTER TABLE stu MODIFY id INT;</span><br><span class=\"line\">\t</span><br><span class=\"line\">4. 添加自动增长</span><br><span class=\"line\">\tALTER TABLE stu MODIFY id INT AUTO_INCREMENT;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"7-4-外键约束\"><a href=\"#7-4-外键约束\" class=\"headerlink\" title=\"7.4 外键约束\"></a>7.4 外键约束</h2><h3 id=\"SQL数据\"><a href=\"#SQL数据\" class=\"headerlink\" title=\"SQL数据\"></a>SQL数据</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE emp ( </span><br><span class=\"line\"> </span><br><span class=\"line\">id INT PRIMARY KEY AUTO_INCREMENT, </span><br><span class=\"line\"> </span><br><span class=\"line\">NAME VARCHAR(30), </span><br><span class=\"line\"> </span><br><span class=\"line\">age INT, </span><br><span class=\"line\"> </span><br><span class=\"line\">dep_name VARCHAR(30), </span><br><span class=\"line\"> </span><br><span class=\"line\">dep_location VARCHAR(30) </span><br><span class=\"line\">); </span><br><span class=\"line\"> </span><br><span class=\"line\">-- 添加数据 </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;张三&#x27;, 20, &#x27;研发部&#x27;, &#x27;广州&#x27;); </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;李四&#x27;, 21, &#x27;研发部&#x27;, &#x27;广州&#x27;); </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;王五&#x27;, 20, &#x27;研发部&#x27;, &#x27;广州&#x27;); </span><br><span class=\"line\"> </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;老王&#x27;, 20, &#x27;销售部&#x27;, &#x27;深圳&#x27;); </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;大王&#x27;, 22, &#x27;销售部&#x27;, &#x27;深圳&#x27;); </span><br><span class=\"line\">INSERT INTO emp (NAME, age, dep_name, dep_location) VALUES (&#x27;小王&#x27;, 18, &#x27;销售部&#x27;, &#x27;深圳&#x27;); </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 解决方案：分成 2 张表 </span><br><span class=\"line\">-- 创建部门表(id,dep_name,dep_location) </span><br><span class=\"line\">-- 一方，主表 </span><br><span class=\"line\">create table department( </span><br><span class=\"line\"> id int primary key auto_increment, </span><br><span class=\"line\"> dep_name varchar(20), </span><br><span class=\"line\"> dep_location varchar(20) </span><br><span class=\"line\">); </span><br><span class=\"line\"> </span><br><span class=\"line\">-- 创建员工表(id,name,age,dep_id) </span><br><span class=\"line\">-- 多方，从表 </span><br><span class=\"line\">create table employee( </span><br><span class=\"line\"> id int primary key auto_increment, </span><br><span class=\"line\"> name varchar(20), </span><br><span class=\"line\"> age int, </span><br><span class=\"line\"> dep_id int  -- 外键对应主表的主键 </span><br><span class=\"line\">) </span><br><span class=\"line\"> </span><br><span class=\"line\">-- 添加 2 个部门 </span><br><span class=\"line\">insert into department values(null, &#x27;研发部&#x27;,&#x27;广州&#x27;),(null, &#x27;销售部&#x27;, &#x27;深圳&#x27;); </span><br><span class=\"line\">select * from department; </span><br><span class=\"line\"> </span><br><span class=\"line\">-- 添加员工,dep_id 表示员工所在的部门 </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;张三&#x27;, 20, 1);</span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;李四&#x27;, 21, 1); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;王五&#x27;, 20, 1); </span><br><span class=\"line\"> </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;老王&#x27;, 20, 2); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;大王&#x27;, 22, 2); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;小王&#x27;, 18, 2); </span><br><span class=\"line\"> </span><br><span class=\"line\">select * from employee;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>外键约束：foreign key,让表于表产生关系，从而保证数据的正确性。</p>\n</li>\n<li><p>在创建表时，可以添加外键</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create table 表名(</span><br><span class=\"line\">\t....</span><br><span class=\"line\">\t外键列</span><br><span class=\"line\">\tconstraint 外键名称 foreign key (外键列名称) references 主表名称(主表列名称)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create table employee( </span><br><span class=\"line\"> id int primary key auto_increment, </span><br><span class=\"line\"> name varchar(20), </span><br><span class=\"line\"> age int, </span><br><span class=\"line\"> dep_id int,-- 外键对应主表的主键 </span><br><span class=\"line\"> -- 创建外键约束 </span><br><span class=\"line\"> constraint emp_depid_fk foreign key (dep_id) references department(id) </span><br><span class=\"line\">) </span><br><span class=\"line\">-- 3) 正常添加数据 </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;张三&#x27;, 20, 1); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;李四&#x27;, 21, 1); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;王五&#x27;, 20, 1); </span><br><span class=\"line\"> </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;老王&#x27;, 20, 2); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;大王&#x27;, 22, 2); </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;小王&#x27;, 18, 2); </span><br><span class=\"line\"> </span><br><span class=\"line\">select * from employee; </span><br><span class=\"line\">-- 4) 部门错误的数据添加失败 </span><br><span class=\"line\">-- 插入不存在的部门 </span><br><span class=\"line\">-- Cannot add or update a child row: a foreign key constraint fails  </span><br><span class=\"line\">INSERT INTO employee (NAME, age, dep_id) VALUES (&#x27;老张&#x27;, 18, 6); </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>删除外键</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE 表名 DROP FOREIGN KEY 外键名称;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建表之后，添加外键</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段名称) REFERENCES 主表名称(主表列名称);</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"第九章-数据库的设计：多表间的关系\"><a href=\"#第九章-数据库的设计：多表间的关系\" class=\"headerlink\" title=\"第九章 数据库的设计：多表间的关系\"></a>第九章 数据库的设计：多表间的关系</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 多表之间的关系</span><br><span class=\"line\">\t1. 分类：</span><br><span class=\"line\">\t\t1. 一对一(了解)：</span><br><span class=\"line\">\t\t\t* 如：人和身份证</span><br><span class=\"line\">\t\t\t* 分析：一个人只有一个身份证，一个身份证只能对应一个人</span><br><span class=\"line\">\t\t2. 一对多(多对一)：</span><br><span class=\"line\">\t\t\t* 如：部门和员工</span><br><span class=\"line\">\t\t\t* 分析：一个部门有多个员工，一个员工只能对应一个部门</span><br><span class=\"line\">\t\t3. 多对多：</span><br><span class=\"line\">\t\t\t* 如：学生和课程</span><br><span class=\"line\">\t\t\t* 分析：一个学生可以选择很多门课程，一个课程也可以被很多学生选择</span><br><span class=\"line\">\t2. 实现关系：</span><br><span class=\"line\">\t\t1. 一对多(多对一)：</span><br><span class=\"line\">\t\t\t* 如：部门和员工</span><br><span class=\"line\">\t\t\t* 实现方式：在多的一方建立外键，指向一的一方的主键。</span><br><span class=\"line\">\t\t2. 多对多：</span><br><span class=\"line\">\t\t\t* 如：学生和课程</span><br><span class=\"line\">\t\t\t* 实现方式：多对多关系实现需要借助第三张中间表。中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键</span><br><span class=\"line\">\t\t3. 一对一(了解)：</span><br><span class=\"line\">\t\t\t* 如：人和身份证</span><br><span class=\"line\">\t\t\t* 实现方式：一对一关系实现，可以在任意一方添加唯一外键指向另一方的主键。</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第十章-事务\"><a href=\"#第十章-事务\" class=\"headerlink\" title=\"第十章 事务\"></a>第十章 事务</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 事务的基本介绍</span><br><span class=\"line\">\t<span class=\"number\">1.</span> 概念：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span>  如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败。</span><br><span class=\"line\"><span class=\"number\">2.</span> 事务的四大特征：</span><br><span class=\"line\">\t<span class=\"number\">1.</span> 原子性：是不可分割的最小操作单位，要么同时成功，要么同时失败。</span><br><span class=\"line\">\t<span class=\"number\">2.</span> 持久性：当事务提交或回滚后，数据库会持久化的 保存数据。</span><br><span class=\"line\">\t<span class=\"number\">3.</span> 隔离性：多个事务之间。相互独立。</span><br><span class=\"line\">\t<span class=\"number\">4.</span> 一致性：事务操作前后，数据总量不变</span><br><span class=\"line\"><span class=\"number\">3.</span> MySQL数据库中事务默认自动提交</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 事务提交的两种方式：</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 自动提交：</span><br><span class=\"line\">\t\t\t\t<span class=\"operator\">*</span> mysql就是自动提交的</span><br><span class=\"line\">\t\t\t\t<span class=\"operator\">*</span> 一条DML(增删改)语句会自动提交一次事务,DDL语言不涉及事务</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 手动提交：</span><br><span class=\"line\">\t\t\t\t<span class=\"operator\">*</span> Oracle 数据库默认是手动提交事务</span><br><span class=\"line\">\t\t\t\t<span class=\"operator\">*</span> 需要先开启事务，再提交</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 修改事务的默认提交方式：</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 查看事务的默认提交方式：<span class=\"keyword\">show</span> variables <span class=\"keyword\">like</span> <span class=\"string\">&#x27;autocommit&#x27;</span>; <span class=\"comment\">-- on 表示事物开启</span></span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 修改默认提交方式： <span class=\"keyword\">set</span> autocommit <span class=\"operator\">=</span> <span class=\"number\">0</span>; <span class=\"comment\">-- 关闭事务  set autocommit = 1; 开启事务</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">4.</span> 操作：</span><br><span class=\"line\">        <span class=\"number\">1</span>  关闭自动提交事务 <span class=\"keyword\">set</span> autocommit <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"number\">2.</span> 开启事务： <span class=\"keyword\">start</span> transaction; (可选)</span><br><span class=\"line\">        ....DML语句  <span class=\"keyword\">select</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">update</span> <span class=\"keyword\">alter</span></span><br><span class=\"line\">\t\t<span class=\"number\">3.</span> 回滚：<span class=\"keyword\">rollback</span>  或者  提交：<span class=\"keyword\">commit</span>;</span><br><span class=\"line\"><span class=\"number\">5.</span> 例子：</span><br><span class=\"line\">\t\t<span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> account (</span><br><span class=\"line\">\t\t\tid <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class=\"line\">\t\t\tNAME <span class=\"type\">VARCHAR</span>(<span class=\"number\">10</span>),</span><br><span class=\"line\">\t\t\tbalance <span class=\"keyword\">DOUBLE</span></span><br><span class=\"line\">\t\t);</span><br><span class=\"line\">\t\t<span class=\"comment\">-- 添加数据</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> account (NAME, balance) <span class=\"keyword\">VALUES</span> (<span class=\"string\">&#x27;zhangsan&#x27;</span>, <span class=\"number\">1000</span>),(<span class=\"string\">&#x27;lisi&#x27;</span>, <span class=\"number\">1000</span>);\t</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> account;</span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> account <span class=\"keyword\">SET</span> balance <span class=\"operator\">=</span> <span class=\"number\">1000</span>;</span><br><span class=\"line\"><span class=\"comment\">-- 张三给李四转账 500 元</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 0. 开启事务</span></span><br><span class=\"line\"><span class=\"keyword\">START</span> TRANSACTION;</span><br><span class=\"line\"><span class=\"comment\">-- 1. 张三账户 -500</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> account <span class=\"keyword\">SET</span> balance <span class=\"operator\">=</span> balance <span class=\"operator\">-</span> <span class=\"number\">500</span> <span class=\"keyword\">WHERE</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;zhangsan&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">-- 2. 李四账户 +500</span></span><br><span class=\"line\"><span class=\"comment\">-- 出错了...</span></span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> account <span class=\"keyword\">SET</span> balance <span class=\"operator\">=</span> balance <span class=\"operator\">+</span> <span class=\"number\">500</span> <span class=\"keyword\">WHERE</span> NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;lisi&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 发现执行没有问题，提交事务</span></span><br><span class=\"line\"><span class=\"keyword\">COMMIT</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 发现出问题了，回滚事务</span></span><br><span class=\"line\"><span class=\"keyword\">ROLLBACK</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">6.</span>事务的隔离级别（了解）</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 概念：多个事务之间隔离的，相互独立的。但是如果多个事务操作同一批数据，则会引发一些问题，设置不同的隔离级别就可以解决这些问题。</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 存在问题：</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> 脏读：一个事务，读取到另一个事务中没有提交的数据</span><br><span class=\"line\">\t\t<span class=\"number\">2.</span> 不可重复读：在同一个事务中，两次读取到的数据不一样。</span><br><span class=\"line\">\t\t<span class=\"number\">3.</span> 幻读(虚读)：一个事务操作(DML)数据表中所有记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。</span><br><span class=\"line\">\t<span class=\"operator\">*</span> 隔离级别：</span><br><span class=\"line\">\t\t<span class=\"number\">1.</span> read uncommitted：读未提交</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 产生的问题：脏读、不可重复读、幻读</span><br><span class=\"line\">\t\t<span class=\"number\">2.</span> read committed：读已提交 （Oracle默认）</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 产生的问题：不可重复读、幻读</span><br><span class=\"line\">\t\t<span class=\"number\">3.</span> repeatable read：可重复读 （MySQL默认）</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 产生的问题：幻读</span><br><span class=\"line\">\t\t<span class=\"number\">4.</span> serializable：串行化</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> 可以解决所有的问题</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 注意：隔离级别从小到大安全性越来越高，但是效率越来越低</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 数据库查询隔离级别：</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">select</span> @<span class=\"variable\">@tx</span>_isolation;</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> mysql默认的事务隔离级别为repeatable<span class=\"operator\">-</span>read</span><br><span class=\"line\">\t\t<span class=\"operator\">*</span> 数据库设置隔离级别：</span><br><span class=\"line\">\t\t\t<span class=\"operator\">*</span> <span class=\"keyword\">set</span> session transaction isolation level  级别字符串;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>读未提交(出现脏读的情况)</p>\n<ul>\n<li><p>打开一个客户端A，并设置当前事务模式为read uncommitted（未提交读），查询表account的初始值</p>\n<p>  <img src=\"/mysql%5C11.png\"></p>\n</li>\n<li><p>在客户端A的事务提交之前，打开另一个客户端B，更新表account</p>\n<p>  <img src=\"/mysql%5C12.png\"></p>\n</li>\n<li><p>这时，虽然客户端B的事务还没提交，但是客户端A就可以查询到B已经更新的数据</p>\n<p>  <img src=\"/mysql%5C13.png\"></p>\n</li>\n<li><p>一旦客户端B的事务因为某种原因回滚，所有的操作都将会被撤销，那客户端A查询到的数据其实就是脏数据</p>\n<p>  <img src=\"/mysql%5C14.png\"></p>\n</li>\n<li><p>在客户端A执行更新语句update account set balance &#x3D; balance - 50 where id &#x3D;1，lilei的balance没有变成350，居然是400，是不是很奇怪，数据不一致啊，如果你这么想就太天真 了，在应用程序中，我们会用400-50&#x3D;350，并不知道其他会话回滚了，要想解决这个问题可以采用读已提交的隔离级别</p>\n<p>  <img src=\"/mysql%5C15.png\"></p>\n</li>\n</ul>\n</li>\n<li><p>读已提交</p>\n<ul>\n<li><p>打开一个客户端A，并设置当前事务模式为read committed（读已提交），查询表account的所有记录</p>\n<p>  <img src=\"/mysql%5C21.png\"></p>\n</li>\n<li><p>在客户端A的事务提交之前，打开另一个客户端B，更新表account</p>\n<p>  <img src=\"/mysql%5C22.png\"></p>\n</li>\n<li><p>这时，客户端B的事务还没提交，客户端A不能查询到B已经更新的数据，解决了脏读问题</p>\n<p>  <img src=\"/mysql%5C23.png\"></p>\n</li>\n<li><p>客户端B的事务提交</p>\n<p>  <img src=\"/mysql%5C24.png\"></p>\n</li>\n<li><p>客户端A执行与上一步相同的查询，结果 与上一步不一致，即产生了不可重复读的问题</p>\n<p>  <img src=\"/2021/06/30/mysql/25.png\"></p>\n</li>\n</ul>\n</li>\n<li><p>可重复读</p>\n<ul>\n<li><p>打开一个客户端A，并设置当前事务模式为repeatable read，查询表account的所有记录</p>\n<p>  <img src=\"/mysql%5C31.png\"></p>\n</li>\n<li><p>在客户端A的事务提交之前，打开另一个客户端B，更新表account并提交</p>\n<p>  <img src=\"/mysql%5C32.png\"></p>\n</li>\n<li><p>在客户端A查询表account的所有记录，与步骤（1）查询结果一致，没有出现不可重复读的问题</p>\n<p>  <img src=\"/mysql%5C33.png\"></p>\n</li>\n<li><p>在客户端A，接着执行update balance &#x3D; balance - 50 where id &#x3D; 1，balance没有变成400-50&#x3D;350，lilei的balance值用的是步骤（2）中的350来算的，所以是300，数据的一致性倒是没有被破坏。可重复读的隔离级别下使用了MVCC机制，select操作不会更新版本号，是快照读（历史版本）；insert、update和delete会更新版本号，是当前读（当前版本）。</p>\n<p>  <img src=\"/mysql%5C34.png\"></p>\n</li>\n<li><p>重新打开客户端B，插入一条新数据后提交</p>\n<p>  <img src=\"/mysql%5C35.png\"></p>\n</li>\n<li><p>在客户端A查询表account的所有记录，没有 查出 新增数据，所以出现幻读</p>\n<p>  <img src=\"/mysql%5C36.png\"></p>\n</li>\n</ul>\n</li>\n<li><p>串行化</p>\n<ul>\n<li><p>打开一个客户端A，并设置当前事务模式为serializable，查询表account的初始值</p>\n<p>  <img src=\"/mysql%5C41.png\"></p>\n</li>\n<li><p>打开一个客户端B，并设置当前事务模式为serializable，插入一条记录报错，表被锁了插入失败，mysql中事务隔离级别为serializable时会锁表，因此不会出现幻读的情况，这种隔离级别并发性极低，开发中很少会用到。</p>\n<p>  <img src=\"/mysql%5C42.png\"></p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"第十一章-DCL-了解\"><a href=\"#第十一章-DCL-了解\" class=\"headerlink\" title=\"第十一章 DCL(了解)\"></a>第十一章 DCL(了解)</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* SQL分类：</span><br><span class=\"line\">\t1. DDL：操作数据库和表</span><br><span class=\"line\">\t2. DML：增删改表中数据</span><br><span class=\"line\">\t3. DQL：查询表中数据</span><br><span class=\"line\">\t4. DCL：管理用户，授权</span><br><span class=\"line\"></span><br><span class=\"line\">* DBA：数据库管理员</span><br><span class=\"line\"></span><br><span class=\"line\">* DCL：管理用户，授权</span><br><span class=\"line\">\t1. 管理用户</span><br><span class=\"line\">\t\t1. 添加用户：</span><br><span class=\"line\">\t\t\t* 语法：CREATE USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED BY &#x27;密码&#x27;;</span><br><span class=\"line\">\t\t2. 删除用户：</span><br><span class=\"line\">\t\t\t* 语法：DROP USER &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br><span class=\"line\">\t\t3. 修改用户密码：</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tUPDATE USER SET PASSWORD = PASSWORD(&#x27;新密码&#x27;) WHERE USER = &#x27;用户名&#x27;;</span><br><span class=\"line\">\t\t\tUPDATE USER SET PASSWORD = PASSWORD(&#x27;abc&#x27;) WHERE USER = &#x27;lisi&#x27;;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tSET PASSWORD FOR &#x27;用户名&#x27;@&#x27;主机名&#x27; = PASSWORD(&#x27;新密码&#x27;);</span><br><span class=\"line\">\t\t\tSET PASSWORD FOR &#x27;root&#x27;@&#x27;localhost&#x27; = PASSWORD(&#x27;123&#x27;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t* mysql中忘记了root用户的密码？</span><br><span class=\"line\">\t\t\t\t1. cmd -- &gt; net stop mysql 停止mysql服务</span><br><span class=\"line\">\t\t\t\t\t* 需要管理员运行该cmd</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t2. 使用无验证方式启动mysql服务： mysqld --skip-grant-tables</span><br><span class=\"line\">\t\t\t\t3. 打开新的cmd窗口,直接输入mysql命令，敲回车。就可以登录成功</span><br><span class=\"line\">\t\t\t\t4. use mysql;</span><br><span class=\"line\">\t\t\t\t5. update user set password = password(&#x27;你的新密码&#x27;) where user = &#x27;root&#x27;;</span><br><span class=\"line\">\t\t\t\t6. 关闭两个窗口</span><br><span class=\"line\">\t\t\t\t7. 打开任务管理器，手动结束mysqld.exe 的进程</span><br><span class=\"line\">\t\t\t\t8. 启动mysql服务</span><br><span class=\"line\">\t\t\t\t9. 使用新密码登录。</span><br><span class=\"line\">\t\t4. 查询用户：</span><br><span class=\"line\">\t\t\t-- 1. 切换到mysql数据库</span><br><span class=\"line\">\t\t\tUSE mysql;</span><br><span class=\"line\">\t\t\t-- 2. 查询user表</span><br><span class=\"line\">\t\t\tSELECT * FROM USER;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t* 通配符： % 表示可以在任意主机使用用户登录数据库</span><br><span class=\"line\"></span><br><span class=\"line\">\t2. 权限管理：</span><br><span class=\"line\">\t\t1. 查询权限：</span><br><span class=\"line\">\t\t\t-- 查询权限</span><br><span class=\"line\">\t\t\tSHOW GRANTS FOR &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br><span class=\"line\">\t\t\tSHOW GRANTS FOR &#x27;lisi&#x27;@&#x27;%&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t2. 授予权限：</span><br><span class=\"line\">\t\t\t-- 授予权限</span><br><span class=\"line\">\t\t\tgrant 权限列表 on 数据库名.表名 to &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br><span class=\"line\">\t\t\t-- 给张三用户授予所有权限，在任意数据库任意表上</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tGRANT ALL ON *.* TO &#x27;zhangsan&#x27;@&#x27;localhost&#x27;;</span><br><span class=\"line\">\t\t3. 撤销权限：</span><br><span class=\"line\">\t\t\t-- 撤销权限：</span><br><span class=\"line\">\t\t\trevoke 权限列表 on 数据库名.表名 from &#x27;用户名&#x27;@&#x27;主机名&#x27;;</span><br><span class=\"line\">\t\t\tREVOKE UPDATE ON db3.`account` FROM &#x27;lisi&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第十二章-数据库的备份和还原\"><a href=\"#第十二章-数据库的备份和还原\" class=\"headerlink\" title=\"第十二章 数据库的备份和还原\"></a>第十二章 数据库的备份和还原</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1.</span> 命令行：</span><br><span class=\"line\">\t语法：</span><br><span class=\"line\">\t\t备份： mysqldump <span class=\"operator\">-</span>u用户名 <span class=\"operator\">-</span>p密码 数据库名称 <span class=\"operator\">&gt;</span> 保存的路径</span><br><span class=\"line\">\t\t还原：</span><br><span class=\"line\">\t\t\t<span class=\"number\">1.</span> 登录数据库</span><br><span class=\"line\">\t\t\t<span class=\"number\">2.</span> 创建数据库</span><br><span class=\"line\">\t\t\t<span class=\"number\">3.</span> 使用数据库</span><br><span class=\"line\">\t\t\t<span class=\"number\">4.</span> 执行文件。source 文件路径</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注：关系型数据库和非关系型数据库区别\"><a href=\"#注：关系型数据库和非关系型数据库区别\" class=\"headerlink\" title=\"注：关系型数据库和非关系型数据库区别\"></a>注：关系型数据库和非关系型数据库区别</h2><ul>\n<li><p><strong>实质</strong></p>\n<ul>\n<li><strong>关系型数据库</strong>，采用关系模型来组织数据。简单来说，<strong>关系模型指的就是二维表格模型</strong>。类似于Excel工作表。</li>\n<li><strong>非关系型数据库</strong>，可看成传统关系型数据库的功能阉割版本，基于键值对存储数据，通过减少很少用的功能，来提高性能</li>\n</ul>\n</li>\n<li><p><strong>价格</strong></p>\n<ul>\n<li>目前基本上大部分主流的非关系型数据库都是免费的。而比较有名气的关系型数据库，比如Oracle、DB2、SQL  Server是收费的。虽然MySQL免费，但它需要做很多工作才能正式用于生产。</li>\n</ul>\n</li>\n<li><p><strong>应用场景</strong></p>\n<ul>\n<li>实际开发中，有很多业务需求，其实并不需要完整的关系型数据库功能，非关系型数据库的功能就足够使用了。这种情况下，使用性能更高、成本更低的非关系型数据库当然是更明智的选择。比如：日志收集、排行榜、定时器等。</li>\n</ul>\n</li>\n<li><p><strong>各自优势</strong></p>\n<ul>\n<li><strong>关系型数据库的优势：</strong><ul>\n<li><strong>复杂查询</strong><br>可以用SQL语句方便的在一个表以及多个表之间做非常复杂的数据查询。</li>\n<li><strong>事务支持</strong><br>使得对于安全性能很高的数据访问要求得以实现。</li>\n</ul>\n</li>\n<li><strong>非关系型数据库的优势：</strong><ul>\n<li><strong>性能</strong><br>NOSQL是基于键值对的，可以想象成表中的主键和值的对应关系，而且不需要经过SQL层的解析，所以性能非常高。</li>\n<li><strong>可扩展性</strong><br>同样也是因为基于键值对，数据之间没有耦合性，所以非常容易水平扩展。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"注：关系型数据库设计规则\"><a href=\"#注：关系型数据库设计规则\" class=\"headerlink\" title=\"注：关系型数据库设计规则\"></a>注：关系型数据库设计规则</h2><ul>\n<li><p><strong>遵循ER模型和三范式</strong></p>\n<ul>\n<li>E    entity   代表实体的意思      对应到数据库当中的一张表          </li>\n<li>R    relationship 代表关系的意思</li>\n</ul>\n</li>\n<li><p><strong>三范式：1、列不能拆分     2、唯一标识    3、关系引用主键</strong></p>\n</li>\n<li><p><strong>具体体现</strong></p>\n<ul>\n<li>将数据放到表中，表再放到库中。</li>\n<li>一个数据库中可以有多个表，每个表都有一个名字，用来标识自己。表名具有唯一性。</li>\n<li>表具有一些特性，这些特性定义了数据在表中如何存储，类似java和python中 “类”的设计。</li>\n<li>表由列组成，我们也称为<strong>字段</strong>。每个字段描述了它所含有的数据的意义，<strong>数据表的设计实际上就是对字段的设计</strong>。创建数据表时，为每个字段分配一个数据类型，定义它们的数据长度和字段名。每个字段类似java 或者python中的“实例属性”。</li>\n<li>表中的数据是按行存储的，一行即为一条记录。每一行类似于java或python中的“对象”。<img src=\"/2021/06/30/mysql/1554904472176.png\" alt=\"1554904472176\"></li>\n</ul>\n<p>类似于生活的存储柜：</p>\n<p><img src=\"/2021/06/30/mysql/1554947249964.png\" alt=\"1554947249964\"></p>\n</li>\n</ul>\n","tags":[]}]